<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>SEO Action Plan - Chris David Salon Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .data-live { background-color: #dcfce7; color: #166534; }
        .data-error { background-color: #fee2e2; color: #991b1b; }
        .task-card { transition: all 0.2s; }
        .task-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <header class="bg-gradient-to-r from-blue-900 to-purple-900 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-white hover:text-gray-200"><i class="fas fa-arrow-left"></i></a>
                    <h1 class="text-2xl font-bold"><i class="fas fa-rocket mr-2"></i>SEO Action Plan</h1>
                    <span id="versionBadge" class="bg-green-500 px-3 py-1 rounded text-sm font-bold">Loading...</span>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="dataSourceBadge" class="text-xs font-semibold px-2.5 py-0.5 rounded bg-green-200 text-green-800">Checking...</span>
                    <span id="lastUpdated" class="text-sm text-blue-200">Loading...</span>
                    <button onclick="refreshData()" class="bg-white text-blue-900 px-4 py-2 rounded-lg hover:bg-gray-100 font-semibold">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                </div>
            </div>
        </div>
    </header>

    <nav class="bg-white border-b">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex space-x-4 overflow-x-auto py-2">
                <a href="index.html" class="px-4 py-2 text-gray-600 hover:text-purple-600 whitespace-nowrap">SEO Score</a>
                <a href="visitor-metrics.html" class="px-4 py-2 text-gray-600 hover:text-purple-600 whitespace-nowrap">Traffic</a>
                <a href="engagement-tracker.html" class="px-4 py-2 text-gray-600 hover:text-purple-600 whitespace-nowrap">Conversions</a>
                <a href="competitors.html" class="px-4 py-2 text-gray-600 hover:text-purple-600 whitespace-nowrap">Competitors</a>
                <a href="rankings.html" class="px-4 py-2 text-gray-600 hover:text-purple-600 whitespace-nowrap">Rankings</a>
                <a href="seo-action-plan.html" class="px-4 py-2 text-purple-600 border-b-2 border-purple-600 font-semibold whitespace-nowrap">Action Plan</a>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500">SEO Score</p>
                        <p class="text-3xl font-bold text-gray-900" id="seoScore">--</p>
                    </div>
                    <div class="p-3 bg-blue-100 rounded-lg">
                        <i class="fas fa-chart-line text-blue-600 text-xl"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500">Market Position</p>
                        <p class="text-3xl font-bold text-gray-900" id="marketPosition">--</p>
                    </div>
                    <div class="p-3 bg-yellow-100 rounded-lg">
                        <i class="fas fa-trophy text-yellow-600 text-xl"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500">Monthly Visitors</p>
                        <p class="text-3xl font-bold text-gray-900" id="monthlyVisitors">--</p>
                    </div>
                    <div class="p-3 bg-green-100 rounded-lg">
                        <i class="fas fa-users text-green-600 text-xl"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500">Potential Revenue</p>
                        <p class="text-3xl font-bold text-gray-900" id="potentialRevenue">--</p>
                    </div>
                    <div class="p-3 bg-purple-100 rounded-lg">
                        <i class="fas fa-dollar-sign text-purple-600 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Priority Actions -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- High Priority -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="bg-red-600 text-white px-6 py-4">
                    <h3 class="text-xl font-bold"><i class="fas fa-fire mr-2"></i>High Priority Actions</h3>
                    <p class="text-sm text-red-100">Do this week for maximum impact</p>
                </div>
                <div id="highPriorityTasks" class="p-4 space-y-3">
                    <div class="text-gray-500 text-center py-8">Loading tasks...</div>
                </div>
            </div>

            <!-- Medium Priority -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="bg-yellow-500 text-white px-6 py-4">
                    <h3 class="text-xl font-bold"><i class="fas fa-clock mr-2"></i>Medium Priority Actions</h3>
                    <p class="text-sm text-yellow-100">Complete this month</p>
                </div>
                <div id="mediumPriorityTasks" class="p-4 space-y-3">
                    <div class="text-gray-500 text-center py-8">Loading tasks...</div>
                </div>
            </div>
        </div>

        <!-- Opportunities -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h3 class="text-lg font-bold text-gray-900 mb-4">
                <i class="fas fa-lightbulb text-yellow-600 mr-2"></i>Growth Opportunities
            </h3>
            <div id="opportunitiesSection" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="text-gray-500 text-center py-8 col-span-3">Loading opportunities...</div>
            </div>
        </div>

        <!-- Competitor Gap Analysis -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-900 mb-4">
                <i class="fas fa-trophy text-yellow-600 mr-2"></i>Competitor Gap Analysis
            </h3>
            <div id="competitorGapSection">
                <div class="text-gray-500 text-center py-8">Loading competitor data...</div>
            </div>
        </div>
    </main>

    <script>
        // ALL DATA FROM API - NO HARDCODED VALUES
        let dashboardData = null;

        async function loadVersion() {
            try {
                const response = await fetch('/data/version.json');
                const data = await response.json();
                document.getElementById('versionBadge').textContent = `v${data.version}`;
            } catch (e) {
                document.getElementById('versionBadge').textContent = 'v?.?.?';
            }
        }

        async function fetchDashboardData() {
            try {
                const response = await fetch('/api/admin-data?type=dashboard');
                const result = await response.json();

                if (result.success) {
                    dashboardData = result.data;
                    return result;
                } else {
                    throw new Error(result.error || 'Failed to fetch data');
                }
            } catch (error) {
                console.error('Error:', error);
                return { success: false, error: error.message };
            }
        }

        function updateUI(result) {
            const badge = document.getElementById('dataSourceBadge');

            if (!result.success) {
                badge.className = 'text-xs font-semibold px-2.5 py-0.5 rounded data-error';
                badge.textContent = 'API Error';
                return;
            }

            badge.className = 'text-xs font-semibold px-2.5 py-0.5 rounded data-live';
            badge.textContent = 'Live API Data';

            const data = result.data;

            // Update summary cards
            document.getElementById('seoScore').textContent = data.seoScore;
            document.getElementById('marketPosition').textContent = '#' + data.marketPosition;
            document.getElementById('monthlyVisitors').textContent = data.monthlyVisitors;
            document.getElementById('potentialRevenue').textContent = '$' + data.opportunities.missedRevenue.toLocaleString();

            // Update tasks
            updateTasks(data.actionItems);

            // Update opportunities
            updateOpportunities(data.opportunities);

            // Update competitor gap
            updateCompetitorGap(data.topCompetitors);

            // Update timestamp
            document.getElementById('lastUpdated').textContent = `Updated: ${new Date().toLocaleString()}`;
        }

        function updateTasks(items) {
            const highPriority = items.filter(i => i.priority === 'high');
            const mediumPriority = items.filter(i => i.priority === 'medium');

            document.getElementById('highPriorityTasks').innerHTML = highPriority.length > 0 ?
                highPriority.map(task => `
                    <div class="task-card p-4 bg-red-50 rounded-lg border border-red-200">
                        <h4 class="font-semibold text-gray-900">${task.task}</h4>
                        <p class="text-sm text-gray-600 mt-1">Impact: ${task.impact}</p>
                    </div>
                `).join('') : '<p class="text-gray-500 text-center py-4">No high priority tasks</p>';

            document.getElementById('mediumPriorityTasks').innerHTML = mediumPriority.length > 0 ?
                mediumPriority.map(task => `
                    <div class="task-card p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                        <h4 class="font-semibold text-gray-900">${task.task}</h4>
                        <p class="text-sm text-gray-600 mt-1">Impact: ${task.impact}</p>
                    </div>
                `).join('') : '<p class="text-gray-500 text-center py-4">No medium priority tasks</p>';
        }

        function updateOpportunities(opp) {
            document.getElementById('opportunitiesSection').innerHTML = `
                <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                    <div class="text-center">
                        <i class="fas fa-dollar-sign text-green-600 text-2xl mb-2"></i>
                        <p class="text-2xl font-bold text-green-600">$${opp.missedRevenue.toLocaleString()}</p>
                        <p class="text-sm text-gray-600">Potential Monthly Revenue</p>
                    </div>
                </div>
                <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <div class="text-center">
                        <i class="fas fa-users text-blue-600 text-2xl mb-2"></i>
                        <p class="text-2xl font-bold text-blue-600">${opp.potentialVisitors.toLocaleString()}</p>
                        <p class="text-sm text-gray-600">Target Visitors Goal</p>
                    </div>
                </div>
                <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                    <div class="text-center">
                        <i class="fas fa-star text-yellow-600 text-2xl mb-2"></i>
                        <p class="text-2xl font-bold text-yellow-600">${opp.reviewsNeeded}</p>
                        <p class="text-sm text-gray-600">Reviews Needed to Rank Up</p>
                    </div>
                </div>
            `;
        }

        function updateCompetitorGap(competitors) {
            const chrisDavid = competitors.find(c => c.name.includes('Chris David'));
            const leader = competitors[0];

            if (!chrisDavid || !leader) {
                document.getElementById('competitorGapSection').innerHTML = '<p class="text-gray-500">No competitor data</p>';
                return;
            }

            const reviewGap = leader.reviews - chrisDavid.reviews;
            const positionGap = chrisDavid.position - leader.position;

            document.getElementById('competitorGapSection').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-3">Your Position vs #1</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                <span>Position Gap</span>
                                <span class="font-bold text-red-600">${positionGap} spots behind</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                <span>Review Gap</span>
                                <span class="font-bold text-red-600">${reviewGap} reviews behind</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                <span>Your Reviews</span>
                                <span class="font-bold text-blue-600">${chrisDavid.reviews}</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                <span>Leader's Reviews</span>
                                <span class="font-bold text-green-600">${leader.reviews}</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-3">Top 5 Competitors</h4>
                        <div class="space-y-2">
                            ${competitors.map(c => `
                                <div class="flex justify-between items-center p-2 ${c.name.includes('Chris David') ? 'bg-blue-100 rounded font-semibold' : ''}">
                                    <span>#${c.position} ${c.name}</span>
                                    <span>${c.reviews} reviews (${c.rating}â˜…)</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        async function refreshData() {
            document.getElementById('lastUpdated').textContent = 'Refreshing...';
            const result = await fetchDashboardData();
            updateUI(result);
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await loadVersion();
            await refreshData();
        });
    </script>
</body>
</html>
