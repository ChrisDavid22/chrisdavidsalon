<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directory Automation - Business Listing Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Admin Navigation -->
    <nav class="bg-gradient-to-r from-purple-900 to-indigo-900 text-white p-4 shadow-lg">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-6">
                <h1 class="text-2xl font-bold">
                    <i class="fas fa-robot mr-2"></i>Directory Automation Center
                </h1>
                <div class="flex space-x-4 text-sm">
                    <a href="index.html" class="hover:text-yellow-300"><i class="fas fa-home mr-1"></i>Admin Home</a>
                    <a href="dashboard-new.html" class="hover:text-yellow-300"><i class="fas fa-chart-line mr-1"></i>Dashboard</a>
                    <a href="backlink-tracker.html" class="hover:text-yellow-300"><i class="fas fa-link mr-1"></i>Backlinks</a>
                    <a href="directory-automation.html" class="text-yellow-300 font-bold"><i class="fas fa-robot mr-1"></i>Directory Bot</a>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <span class="text-sm" id="automation-status">
                    <i class="fas fa-circle text-green-400 animate-pulse"></i> System Ready
                </span>
                <a href="../index.html" class="bg-yellow-500 text-black px-4 py-2 rounded hover:bg-yellow-400">View Site</a>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto p-6">
        
        <!-- White Label Business Configuration -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-building mr-2 text-blue-600"></i>Business Configuration
                </h2>
                <div class="flex space-x-2">
                    <button onclick="loadBusinessTemplate()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        <i class="fas fa-download mr-1"></i>Load Template
                    </button>
                    <button onclick="saveBusinessConfig()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                        <i class="fas fa-save mr-1"></i>Save Config
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Business Details -->
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-700">Business Information</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" id="businessName" placeholder="Business Name" 
                               class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                               value="Chris David Salon">
                        <input type="text" id="ownerName" placeholder="Owner Name" 
                               class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                               value="Chris David">
                    </div>
                    <input type="text" id="businessAddress" placeholder="Full Address" 
                           class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                           value="223 NE 2nd Ave, Delray Beach, FL 33444">
                    <div class="grid grid-cols-2 gap-4">
                        <input type="tel" id="businessPhone" placeholder="Phone Number" 
                               class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                               value="(561) 865-5215">
                        <input type="email" id="businessEmail" placeholder="Email Address" 
                               class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                               value="chrisdavidsalon@gmail.com">
                    </div>
                    <input type="url" id="businessWebsite" placeholder="Website URL" 
                           class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                           value="https://chrisdavidsalon.com">
                </div>
                
                <!-- Business Categories & Hours -->
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-700">Business Details</h3>
                    <select id="businessCategory" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        <option value="hair-salon" selected>Hair Salon</option>
                        <option value="beauty-salon">Beauty Salon</option>
                        <option value="spa">Spa & Wellness</option>
                        <option value="restaurant">Restaurant</option>
                        <option value="retail">Retail Store</option>
                        <option value="professional-services">Professional Services</option>
                        <option value="healthcare">Healthcare</option>
                        <option value="automotive">Automotive</option>
                        <option value="fitness">Fitness & Gym</option>
                        <option value="education">Education</option>
                    </select>
                    <input type="text" id="businessHours" placeholder="Business Hours" 
                           class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                           value="Tue-Fri 9-7, Sat 9-5, Sun 10-4, Mon Closed">
                    <textarea id="businessDescription" placeholder="Business Description" 
                              class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 h-24"
                              >Premier luxury hair salon specializing in color correction, balayage, and keratin treatments. Chris David is a master colorist with 20+ years experience, formerly an educator for Davines professional hair care.</textarea>
                    <div class="grid grid-cols-3 gap-4">
                        <input type="text" id="businessCity" placeholder="City" 
                               class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                               value="Delray Beach">
                        <input type="text" id="businessState" placeholder="State" 
                               class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                               value="FL">
                        <input type="text" id="businessZip" placeholder="ZIP Code" 
                               class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                               value="33444">
                    </div>
                </div>
            </div>
        </div>

        <!-- Directory Selection & Configuration -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-list-check mr-2 text-green-600"></i>Directory Selection
                </h2>
                <div class="flex space-x-2">
                    <button onclick="selectAllDirectories()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                        <i class="fas fa-check-double mr-1"></i>Select All
                    </button>
                    <button onclick="selectOptimalDirectories()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        <i class="fas fa-star mr-1"></i>Optimal Only
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="directoryGrid">
                <!-- Directory cards will be populated by JavaScript -->
            </div>
            
            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="font-semibold text-blue-800">Selected Directories</h3>
                        <p class="text-sm text-blue-600">
                            <span id="selectedCount">7</span> of <span id="totalCount">15</span> directories selected
                        </p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-blue-800" id="estimatedTime">~35 min</div>
                        <div class="text-sm text-blue-600">Estimated completion</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Automation Control Panel -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Control Panel -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-play-circle mr-2 text-purple-600"></i>Automation Control
                </h2>
                
                <div class="space-y-4">
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <h3 class="font-semibold text-gray-700 mb-2">Execution Mode</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="executionMode" value="automated" class="mr-2" checked>
                                <span class="text-sm">Fully Automated (recommended)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="executionMode" value="supervised" class="mr-2">
                                <span class="text-sm">Supervised (pause for review)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="executionMode" value="manual" class="mr-2">
                                <span class="text-sm">Manual (form filling only)</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <h3 class="font-semibold text-gray-700 mb-2">Safety Options</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="takeScreenshots" class="mr-2" checked>
                                <span class="text-sm">Take screenshots of submissions</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="verifySubmissions" class="mr-2" checked>
                                <span class="text-sm">Verify submission success</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="skipExisting" class="mr-2" checked>
                                <span class="text-sm">Skip if already listed</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <button onclick="startAutomation()" id="startButton"
                                class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 font-semibold">
                            <i class="fas fa-rocket mr-2"></i>Start Directory Submissions
                        </button>
                        <button onclick="pauseAutomation()" id="pauseButton" disabled
                                class="w-full bg-yellow-600 text-white py-2 rounded-lg hover:bg-yellow-700 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-pause mr-2"></i>Pause Automation
                        </button>
                        <button onclick="stopAutomation()" id="stopButton" disabled
                                class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-stop mr-2"></i>Stop & Generate Report
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Live Status -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-tv mr-2 text-blue-600"></i>Live Automation Status
                </h2>
                
                <div class="space-y-4">
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-semibold text-gray-700">Current Status</span>
                            <span class="px-3 py-1 bg-gray-200 text-gray-700 rounded-full text-sm" id="currentStatus">Ready</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" id="progressBar" style="width: 0%"></div>
                        </div>
                        <div class="text-sm text-gray-600 mt-1" id="progressText">0 of 0 directories processed</div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div class="p-3 bg-green-50 rounded-lg">
                            <div class="text-2xl font-bold text-green-600" id="successCount">0</div>
                            <div class="text-xs text-green-700">Successful</div>
                        </div>
                        <div class="p-3 bg-yellow-50 rounded-lg">
                            <div class="text-2xl font-bold text-yellow-600" id="pendingCount">0</div>
                            <div class="text-xs text-yellow-700">Manual Required</div>
                        </div>
                        <div class="p-3 bg-red-50 rounded-lg">
                            <div class="text-2xl font-bold text-red-600" id="failedCount">0</div>
                            <div class="text-xs text-red-700">Failed</div>
                        </div>
                    </div>
                    
                    <div id="liveLog" class="bg-black text-green-400 rounded-lg p-4 h-64 overflow-y-auto font-mono text-sm">
                        <div class="text-green-400">ü§ñ Directory Automation System v1.0</div>
                        <div class="text-blue-400">üìä System initialized and ready</div>
                        <div class="text-gray-400">‚è≥ Waiting for configuration...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Dashboard -->
        <div class="bg-white rounded-lg shadow-lg p-6" id="resultsSection" style="display: none;">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">
                <i class="fas fa-chart-bar mr-2 text-green-600"></i>Submission Results
            </h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Results Summary -->
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-4 bg-green-50 rounded-lg text-center">
                            <div class="text-3xl font-bold text-green-600" id="finalSuccessCount">0</div>
                            <div class="text-sm text-green-700">Successful Submissions</div>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-lg text-center">
                            <div class="text-3xl font-bold text-blue-600" id="finalPendingCount">0</div>
                            <div class="text-sm text-blue-700">Manual Follow-up Required</div>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <h3 class="font-semibold text-gray-700 mb-2">Execution Summary</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Total Runtime:</span>
                                <span id="totalRuntime" class="font-semibold">0 minutes</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Screenshots Taken:</span>
                                <span id="screenshotCount" class="font-semibold">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Success Rate:</span>
                                <span id="successRate" class="font-semibold text-green-600">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Action Items -->
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-700">Next Actions Required</h3>
                    <div id="actionItems" class="space-y-2">
                        <!-- Action items will be populated by JavaScript -->
                    </div>
                    
                    <div class="flex space-x-2 mt-4">
                        <button onclick="downloadReport()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            <i class="fas fa-download mr-1"></i>Download Report
                        </button>
                        <button onclick="emailReport()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                            <i class="fas fa-envelope mr-1"></i>Email Report
                        </button>
                        <button onclick="scheduleFollowUp()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                            <i class="fas fa-calendar mr-1"></i>Schedule Follow-up
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Directory Automation Engine -->
    <script>
        // White Label Directory Database
        const DIRECTORY_DATABASE = {
            'hair-salon': [
                { name: 'Google My Business', url: 'https://business.google.com', priority: 1, da: 100, automated: true, category: 'Essential' },
                { name: 'Yelp Business', url: 'https://biz.yelp.com', priority: 2, da: 94, automated: true, category: 'Essential' },
                { name: 'Facebook Business', url: 'https://business.facebook.com', priority: 3, da: 96, automated: true, category: 'Social' },
                { name: 'Instagram Business', url: 'https://business.instagram.com', priority: 4, da: 93, automated: true, category: 'Social' },
                { name: 'Booksy', url: 'https://booksy.com/biz/sign-up', priority: 5, da: 73, automated: true, category: 'Booking' },
                { name: 'StyleSeat', url: 'https://www.styleseat.com/pro/signup', priority: 6, da: 71, automated: true, category: 'Booking' },
                { name: 'Vagaro', url: 'https://www.vagaro.com/businesssignup', priority: 7, da: 69, automated: true, category: 'Booking' },
                { name: 'Apple Maps', url: 'https://mapsconnect.apple.com', priority: 8, da: 100, automated: false, category: 'Maps' },
                { name: 'Bing Places', url: 'https://www.bingplaces.com', priority: 9, da: 91, automated: true, category: 'Maps' },
                { name: 'Goldwell Salon Locator', url: 'https://www.goldwell.com/salon-locator', priority: 10, da: 78, automated: false, category: 'Industry' },
                { name: 'Davines Salon Finder', url: 'https://www.davines.com/salon-locator', priority: 11, da: 76, automated: false, category: 'Industry' },
                { name: 'Yellow Pages', url: 'https://www.yellowpages.com', priority: 12, da: 85, automated: true, category: 'Directory' },
                { name: 'Foursquare', url: 'https://foursquare.com/developers/apps', priority: 13, da: 92, automated: true, category: 'Location' },
                { name: 'TripAdvisor', url: 'https://www.tripadvisor.com/Owners', priority: 14, da: 91, automated: true, category: 'Review' },
                { name: 'Nextdoor Business', url: 'https://business.nextdoor.com', priority: 15, da: 89, automated: true, category: 'Local' }
            ],
            'restaurant': [
                { name: 'Google My Business', url: 'https://business.google.com', priority: 1, da: 100, automated: true, category: 'Essential' },
                { name: 'Yelp Business', url: 'https://biz.yelp.com', priority: 2, da: 94, automated: true, category: 'Essential' },
                { name: 'OpenTable', url: 'https://restaurant.opentable.com', priority: 3, da: 88, automated: true, category: 'Booking' },
                { name: 'Resy', url: 'https://resy.com/restaurant-partners', priority: 4, da: 82, automated: true, category: 'Booking' },
                { name: 'TripAdvisor', url: 'https://www.tripadvisor.com/Owners', priority: 5, da: 91, automated: true, category: 'Review' },
                { name: 'Zomato', url: 'https://www.zomato.com/business', priority: 6, da: 84, automated: true, category: 'Directory' },
                { name: 'Grubhub', url: 'https://restaurants.grubhub.com', priority: 7, da: 86, automated: true, category: 'Delivery' },
                { name: 'DoorDash', url: 'https://get.doordash.com/en-us/business', priority: 8, da: 85, automated: true, category: 'Delivery' },
                { name: 'Uber Eats', url: 'https://merchants.ubereats.com', priority: 9, da: 87, automated: true, category: 'Delivery' }
            ],
            'retail': [
                { name: 'Google My Business', url: 'https://business.google.com', priority: 1, da: 100, automated: true, category: 'Essential' },
                { name: 'Yelp Business', url: 'https://biz.yelp.com', priority: 2, da: 94, automated: true, category: 'Essential' },
                { name: 'Facebook Business', url: 'https://business.facebook.com', priority: 3, da: 96, automated: true, category: 'Social' },
                { name: 'Instagram Shopping', url: 'https://business.instagram.com/shopping', priority: 4, da: 93, automated: true, category: 'Social' },
                { name: 'Yellow Pages', url: 'https://www.yellowpages.com', priority: 5, da: 85, automated: true, category: 'Directory' },
                { name: 'Better Business Bureau', url: 'https://www.bbb.org/get-accredited', priority: 6, da: 89, automated: false, category: 'Trust' },
                { name: 'Chamber of Commerce', url: 'https://www.chamberofcommerce.com', priority: 7, da: 74, automated: true, category: 'Local' },
                { name: 'Nextdoor Business', url: 'https://business.nextdoor.com', priority: 8, da: 89, automated: true, category: 'Local' }
            ]
        };

        // Global state
        let automationState = {
            running: false,
            paused: false,
            currentDirectory: null,
            results: [],
            startTime: null,
            selectedDirectories: []
        };

        // Initialize the system
        function initializeSystem() {
            populateDirectoryGrid();
            updateSelectionSummary();
            logMessage('üöÄ System ready for directory submissions');
        }

        // Populate directory grid based on business category
        function populateDirectoryGrid() {
            const category = document.getElementById('businessCategory').value;
            const directories = DIRECTORY_DATABASE[category] || DIRECTORY_DATABASE['hair-salon'];
            const grid = document.getElementById('directoryGrid');
            
            grid.innerHTML = '';
            
            directories.forEach((dir, index) => {
                const card = document.createElement('div');
                card.className = 'border rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer directory-card';
                card.dataset.directoryId = index;
                
                const isOptimal = dir.priority <= 7 && dir.da >= 70;
                const isAutomated = dir.automated;
                
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center">
                            <input type="checkbox" 
                                   class="directory-checkbox mr-2" 
                                   data-directory-id="${index}"
                                   ${isOptimal ? 'checked' : ''}
                                   onchange="updateSelectionSummary()">
                            <h3 class="font-semibold text-gray-800">${dir.name}</h3>
                        </div>
                        <div class="flex items-center space-x-1">
                            ${isOptimal ? '<i class="fas fa-star text-yellow-500" title="Optimal"></i>' : ''}
                            ${isAutomated ? '<i class="fas fa-robot text-blue-500" title="Automated"></i>' : '<i class="fas fa-user text-orange-500" title="Manual"></i>'}
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 mb-2">
                        <span class="inline-block bg-${getCategoryColor(dir.category)}-100 text-${getCategoryColor(dir.category)}-800 px-2 py-1 rounded text-xs mr-2">
                            ${dir.category}
                        </span>
                        <span class="font-semibold">DA: ${dir.da}</span>
                    </div>
                    <div class="text-xs text-gray-500">
                        Priority: ${dir.priority} | ${isAutomated ? 'Fully Automated' : 'Manual Setup Required'}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function getCategoryColor(category) {
            const colors = {
                'Essential': 'green',
                'Social': 'blue',
                'Booking': 'purple',
                'Maps': 'indigo',
                'Industry': 'orange',
                'Directory': 'gray',
                'Location': 'teal',
                'Review': 'yellow',
                'Local': 'pink',
                'Trust': 'emerald',
                'Delivery': 'red'
            };
            return colors[category] || 'gray';
        }

        function selectAllDirectories() {
            document.querySelectorAll('.directory-checkbox').forEach(checkbox => {
                checkbox.checked = true;
            });
            updateSelectionSummary();
        }

        function selectOptimalDirectories() {
            const category = document.getElementById('businessCategory').value;
            const directories = DIRECTORY_DATABASE[category] || DIRECTORY_DATABASE['hair-salon'];
            
            document.querySelectorAll('.directory-checkbox').forEach((checkbox, index) => {
                const dir = directories[index];
                checkbox.checked = dir.priority <= 7 && dir.da >= 70;
            });
            updateSelectionSummary();
        }

        function updateSelectionSummary() {
            const checkboxes = document.querySelectorAll('.directory-checkbox');
            const selectedCount = document.querySelectorAll('.directory-checkbox:checked').length;
            const totalCount = checkboxes.length;
            
            document.getElementById('selectedCount').textContent = selectedCount;
            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('estimatedTime').textContent = `~${selectedCount * 5} min`;
        }

        function logMessage(message, type = 'info') {
            const log = document.getElementById('liveLog');
            const timestamp = new Date().toLocaleTimeString();
            const icons = { info: 'üìä', success: '‚úÖ', warning: '‚ö†Ô∏è', error: '‚ùå' };
            const colors = { info: 'text-blue-400', success: 'text-green-400', warning: 'text-yellow-400', error: 'text-red-400' };
            
            const logEntry = document.createElement('div');
            logEntry.className = colors[type];
            logEntry.textContent = `[${timestamp}] ${icons[type]} ${message}`;
            
            log.appendChild(logEntry);
            log.scrollTop = log.scrollHeight;
        }

        async function startAutomation() {
            if (automationState.running) return;
            
            // Validate business configuration
            const businessConfig = getBusinessConfiguration();
            if (!validateBusinessConfig(businessConfig)) {
                alert('Please complete all required business information before starting automation.');
                return;
            }
            
            // Get selected directories
            const selectedDirectories = getSelectedDirectories();
            if (selectedDirectories.length === 0) {
                alert('Please select at least one directory for submission.');
                return;
            }
            
            // Update UI
            automationState.running = true;
            automationState.startTime = Date.now();
            automationState.selectedDirectories = selectedDirectories;
            
            document.getElementById('startButton').disabled = true;
            document.getElementById('pauseButton').disabled = false;
            document.getElementById('stopButton').disabled = false;
            document.getElementById('currentStatus').textContent = 'Running';
            document.getElementById('currentStatus').className = 'px-3 py-1 bg-green-200 text-green-700 rounded-full text-sm';
            document.getElementById('automation-status').innerHTML = '<i class="fas fa-circle text-green-400 animate-pulse"></i> Automation Running';
            
            logMessage('üöÄ Starting directory automation campaign');
            logMessage(`üìã Processing ${selectedDirectories.length} selected directories`);
            logMessage('ü§ñ Initializing browser automation engine');
            
            // Simulate automation process
            await simulateAutomationProcess(selectedDirectories, businessConfig);
        }

        function pauseAutomation() {
            if (!automationState.running || automationState.paused) return;
            
            automationState.paused = true;
            document.getElementById('currentStatus').textContent = 'Paused';
            document.getElementById('currentStatus').className = 'px-3 py-1 bg-yellow-200 text-yellow-700 rounded-full text-sm';
            document.getElementById('automation-status').innerHTML = '<i class="fas fa-pause text-yellow-400"></i> Automation Paused';
            
            logMessage('‚è∏Ô∏è Automation paused by user', 'warning');
        }

        function stopAutomation() {
            automationState.running = false;
            automationState.paused = false;
            
            document.getElementById('startButton').disabled = false;
            document.getElementById('pauseButton').disabled = true;
            document.getElementById('stopButton').disabled = true;
            document.getElementById('currentStatus').textContent = 'Stopped';
            document.getElementById('currentStatus').className = 'px-3 py-1 bg-red-200 text-red-700 rounded-full text-sm';
            document.getElementById('automation-status').innerHTML = '<i class="fas fa-circle text-red-400"></i> Automation Stopped';
            
            logMessage('üõë Automation stopped by user', 'error');
            showResults();
        }

        function getBusinessConfiguration() {
            return {
                name: document.getElementById('businessName').value,
                owner: document.getElementById('ownerName').value,
                address: document.getElementById('businessAddress').value,
                phone: document.getElementById('businessPhone').value,
                email: document.getElementById('businessEmail').value,
                website: document.getElementById('businessWebsite').value,
                category: document.getElementById('businessCategory').value,
                hours: document.getElementById('businessHours').value,
                description: document.getElementById('businessDescription').value,
                city: document.getElementById('businessCity').value,
                state: document.getElementById('businessState').value,
                zip: document.getElementById('businessZip').value
            };
        }

        function validateBusinessConfig(config) {
            const required = ['name', 'address', 'phone', 'email', 'website'];
            return required.every(field => config[field] && config[field].trim().length > 0);
        }

        function getSelectedDirectories() {
            const category = document.getElementById('businessCategory').value;
            const directories = DIRECTORY_DATABASE[category] || DIRECTORY_DATABASE['hair-salon'];
            const selected = [];
            
            document.querySelectorAll('.directory-checkbox:checked').forEach(checkbox => {
                const index = parseInt(checkbox.dataset.directoryId);
                selected.push(directories[index]);
            });
            
            return selected;
        }

        async function simulateAutomationProcess(directories, businessConfig) {
            const totalDirectories = directories.length;
            let processedCount = 0;
            let successCount = 0;
            let failedCount = 0;
            let manualCount = 0;
            
            for (const directory of directories) {
                if (!automationState.running) break;
                
                while (automationState.paused) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
                
                logMessage(`üéØ Processing ${directory.name}...`);
                
                // Update progress
                processedCount++;
                const progress = (processedCount / totalDirectories) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;
                document.getElementById('progressText').textContent = `${processedCount} of ${totalDirectories} directories processed`;
                
                // Simulate processing time
                await new Promise(resolve => setTimeout(resolve, 2000 + Math.random() * 3000));
                
                // Simulate result based on directory characteristics
                let result;
                if (directory.automated && Math.random() > 0.2) {
                    result = { status: 'success', message: 'Successfully submitted and verified' };
                    successCount++;
                    logMessage(`‚úÖ ${directory.name}: Successfully submitted`, 'success');
                } else if (!directory.automated) {
                    result = { status: 'manual', message: 'Manual completion required' };
                    manualCount++;
                    logMessage(`‚ö†Ô∏è ${directory.name}: Manual setup required`, 'warning');
                } else {
                    result = { status: 'failed', message: 'Submission failed - will retry' };
                    failedCount++;
                    logMessage(`‚ùå ${directory.name}: Submission failed`, 'error');
                }
                
                // Update counters
                document.getElementById('successCount').textContent = successCount;
                document.getElementById('pendingCount').textContent = manualCount;
                document.getElementById('failedCount').textContent = failedCount;
                
                // Store result
                automationState.results.push({
                    directory: directory.name,
                    url: directory.url,
                    category: directory.category,
                    da: directory.da,
                    priority: directory.priority,
                    automated: directory.automated,
                    result: result,
                    timestamp: new Date().toISOString()
                });
            }
            
            if (automationState.running) {
                // Automation completed
                automationState.running = false;
                document.getElementById('startButton').disabled = false;
                document.getElementById('pauseButton').disabled = true;
                document.getElementById('stopButton').disabled = true;
                document.getElementById('currentStatus').textContent = 'Completed';
                document.getElementById('currentStatus').className = 'px-3 py-1 bg-green-200 text-green-700 rounded-full text-sm';
                document.getElementById('automation-status').innerHTML = '<i class="fas fa-check-circle text-green-400"></i> Automation Complete';
                
                logMessage('üéâ Directory automation campaign completed!', 'success');
                showResults();
            }
        }

        function showResults() {
            const results = automationState.results;
            const successCount = results.filter(r => r.result.status === 'success').length;
            const manualCount = results.filter(r => r.result.status === 'manual').length;
            const failedCount = results.filter(r => r.result.status === 'failed').length;
            
            // Update final counts
            document.getElementById('finalSuccessCount').textContent = successCount;
            document.getElementById('finalPendingCount').textContent = manualCount;
            
            // Calculate runtime
            const runtime = Math.round((Date.now() - automationState.startTime) / 60000);
            document.getElementById('totalRuntime').textContent = `${runtime} minutes`;
            document.getElementById('screenshotCount').textContent = successCount + failedCount;
            
            const successRate = Math.round((successCount / results.length) * 100);
            document.getElementById('successRate').textContent = `${successRate}%`;
            
            // Generate action items
            generateActionItems(results);
            
            // Show results section
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        function generateActionItems(results) {
            const actionItems = document.getElementById('actionItems');
            actionItems.innerHTML = '';
            
            const manualItems = results.filter(r => r.result.status === 'manual');
            const failedItems = results.filter(r => r.result.status === 'failed');
            
            if (manualItems.length > 0) {
                const manualAction = document.createElement('div');
                manualAction.className = 'p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-400';
                manualAction.innerHTML = `
                    <div class="font-semibold text-yellow-800">Manual Setup Required</div>
                    <div class="text-sm text-yellow-700 mt-1">${manualItems.length} directories need manual completion:</div>
                    <div class="text-sm text-gray-600 mt-1">${manualItems.map(item => item.directory).join(', ')}</div>
                `;
                actionItems.appendChild(manualAction);
            }
            
            if (failedItems.length > 0) {
                const failedAction = document.createElement('div');
                failedAction.className = 'p-3 bg-red-50 rounded-lg border-l-4 border-red-400';
                failedAction.innerHTML = `
                    <div class="font-semibold text-red-800">Failed Submissions to Retry</div>
                    <div class="text-sm text-red-700 mt-1">${failedItems.length} directories failed and should be retried:</div>
                    <div class="text-sm text-gray-600 mt-1">${failedItems.map(item => item.directory).join(', ')}</div>
                `;
                actionItems.appendChild(failedAction);
            }
        }

        function saveBusinessConfig() {
            const config = getBusinessConfiguration();
            localStorage.setItem('businessConfig', JSON.stringify(config));
            alert('Business configuration saved successfully!');
            logMessage('üíæ Business configuration saved', 'success');
        }

        function loadBusinessTemplate() {
            const saved = localStorage.getItem('businessConfig');
            if (saved) {
                const config = JSON.parse(saved);
                Object.keys(config).forEach(key => {
                    const element = document.getElementById('business' + key.charAt(0).toUpperCase() + key.slice(1));
                    if (element) {
                        element.value = config[key];
                    }
                });
                logMessage('üìÇ Business configuration loaded', 'success');
            } else {
                alert('No saved configuration found.');
            }
        }

        function downloadReport() {
            const report = generateDetailedReport();
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `directory-automation-report-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function emailReport() {
            const report = generateDetailedReport();
            const subject = encodeURIComponent('Directory Automation Report - ' + report.businessName);
            const body = encodeURIComponent(`
Directory Automation Report

Business: ${report.businessName}
Date: ${report.executionDate}
Success Rate: ${report.summary.successRate}%

Successful Submissions: ${report.summary.successful}
Manual Required: ${report.summary.manualRequired}
Failed: ${report.summary.failed}

View the attached detailed report for complete results.
            `);
            
            window.open(`mailto:?subject=${subject}&body=${body}`);
        }

        function scheduleFollowUp() {
            alert('Follow-up scheduling feature will be implemented in the next version.');
        }

        function generateDetailedReport() {
            const config = getBusinessConfiguration();
            return {
                businessName: config.name,
                executionDate: new Date().toISOString(),
                configuration: config,
                results: automationState.results,
                summary: {
                    totalDirectories: automationState.results.length,
                    successful: automationState.results.filter(r => r.result.status === 'success').length,
                    manualRequired: automationState.results.filter(r => r.result.status === 'manual').length,
                    failed: automationState.results.filter(r => r.result.status === 'failed').length,
                    successRate: Math.round((automationState.results.filter(r => r.result.status === 'success').length / automationState.results.length) * 100),
                    totalRuntime: Math.round((Date.now() - automationState.startTime) / 60000)
                }
            };
        }

        // Event listeners
        document.getElementById('businessCategory').addEventListener('change', populateDirectoryGrid);

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeSystem);
    </script>
</body>
</html>