<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>SEO Improvement Planner - Chris David Salon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">
    <!-- Navigation -->
    <nav class="bg-gradient-to-r from-green-800 to-teal-800 text-white p-4 shadow-lg">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h1 class="text-2xl font-bold">SEO Improvement Planner</h1>
                    <p class="text-sm text-green-200">What to change & track your progress</p>
                </div>
                <div class="flex items-center gap-4">
                    <span id="lastUpdated" class="text-sm text-green-200">Loading...</span>
                    <button onclick="refreshAll()" class="bg-white text-green-800 px-4 py-2 rounded text-sm font-semibold hover:bg-green-50">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                </div>
            </div>

            <!-- Navigation Menu -->
            <div class="flex space-x-1 pb-2 overflow-x-auto">
                <a href="index.html" class="px-4 py-2 hover:bg-white/10 rounded-t">Dashboard</a>
                <a href="improvement-planner.html" class="px-4 py-2 bg-white/20 rounded-t font-semibold">Improvement Plan</a>
                <a href="traffic.html" class="px-4 py-2 hover:bg-white/10 rounded-t">Traffic</a>
                <a href="authority.html" class="px-4 py-2 hover:bg-white/10 rounded-t">Authority</a>
                <a href="microsites.html" class="px-4 py-2 hover:bg-white/10 rounded-t">Microsites</a>
                <a href="rankings.html" class="px-4 py-2 hover:bg-white/10 rounded-t">Rankings</a>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto p-6">

        <!-- PROGRESS SUMMARY -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                <i class="fas fa-chart-line text-green-500"></i>
                YOUR PROGRESS
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-green-50 rounded-lg p-4 text-center border border-green-200">
                    <div class="text-3xl font-bold text-green-700" id="tasksCompleted">0</div>
                    <div class="text-sm text-green-600">Tasks Completed</div>
                </div>
                <div class="bg-yellow-50 rounded-lg p-4 text-center border border-yellow-200">
                    <div class="text-3xl font-bold text-yellow-700" id="tasksPending">0</div>
                    <div class="text-sm text-yellow-600">In Progress</div>
                </div>
                <div class="bg-blue-50 rounded-lg p-4 text-center border border-blue-200">
                    <div class="text-3xl font-bold text-blue-700" id="reviewsGained">+0</div>
                    <div class="text-sm text-blue-600">Reviews Gained</div>
                </div>
                <div class="bg-purple-50 rounded-lg p-4 text-center border border-purple-200">
                    <div class="text-3xl font-bold text-purple-700" id="rankChange">--</div>
                    <div class="text-sm text-purple-600">Rank Change</div>
                </div>
            </div>
        </div>

        <!-- RANKING FACTORS OVERVIEW -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                <i class="fas fa-pie-chart text-blue-500"></i>
                Local SEO Ranking Factors
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-6 gap-4">
                <div class="text-center p-3 bg-red-50 rounded-lg border border-red-200">
                    <div class="text-2xl font-bold text-red-700">25-30%</div>
                    <div class="text-xs text-red-600">Google Business</div>
                </div>
                <div class="text-center p-3 bg-orange-50 rounded-lg border border-orange-200">
                    <div class="text-2xl font-bold text-orange-700">20-25%</div>
                    <div class="text-xs text-orange-600">On-Page SEO</div>
                </div>
                <div class="text-center p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                    <div class="text-2xl font-bold text-yellow-700">15-20%</div>
                    <div class="text-xs text-yellow-600">Reviews</div>
                </div>
                <div class="text-center p-3 bg-green-50 rounded-lg border border-green-200">
                    <div class="text-2xl font-bold text-green-700">15-20%</div>
                    <div class="text-xs text-green-600">Citations/Links</div>
                </div>
                <div class="text-center p-3 bg-blue-50 rounded-lg border border-blue-200">
                    <div class="text-2xl font-bold text-blue-700">10-15%</div>
                    <div class="text-xs text-blue-600">Technical SEO</div>
                </div>
                <div class="text-center p-3 bg-purple-50 rounded-lg border border-purple-200">
                    <div class="text-2xl font-bold text-purple-700">5-10%</div>
                    <div class="text-xs text-purple-600">Behavioral</div>
                </div>
            </div>
        </div>

        <!-- IMPROVEMENT CATEGORIES -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">

            <!-- GOOGLE BUSINESS PROFILE (25-30%) -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                        <i class="fab fa-google text-red-500"></i>
                        Google Business Profile
                    </h3>
                    <span class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-semibold">25-30% of ranking</span>
                </div>
                <div class="space-y-4 max-h-96 overflow-y-auto" id="gbpTasks"></div>
            </div>

            <!-- ON-PAGE SEO (20-25%) -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                        <i class="fas fa-file-code text-orange-500"></i>
                        On-Page SEO
                    </h3>
                    <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm font-semibold">20-25% of ranking</span>
                </div>
                <div class="space-y-4 max-h-96 overflow-y-auto" id="onpageTasks"></div>
            </div>

            <!-- REVIEWS (15-20%) -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                        <i class="fas fa-star text-yellow-500"></i>
                        Reviews
                    </h3>
                    <span class="px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-sm font-semibold">15-20% of ranking</span>
                </div>
                <div class="space-y-4 max-h-96 overflow-y-auto" id="reviewTasks"></div>
            </div>

            <!-- CITATIONS & LINKS (15-20%) -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                        <i class="fas fa-link text-green-500"></i>
                        Citations & Backlinks
                    </h3>
                    <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-semibold">15-20% of ranking</span>
                </div>
                <div class="space-y-4 max-h-96 overflow-y-auto" id="citationTasks"></div>
            </div>

            <!-- TECHNICAL SEO (10-15%) -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                        <i class="fas fa-cog text-blue-500"></i>
                        Technical SEO
                    </h3>
                    <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold">10-15% of ranking</span>
                </div>
                <div class="space-y-4 max-h-96 overflow-y-auto" id="technicalTasks"></div>
            </div>

            <!-- BEHAVIORAL SIGNALS (5-10%) -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                        <i class="fas fa-mouse-pointer text-purple-500"></i>
                        Behavioral Signals
                    </h3>
                    <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-semibold">5-10% of ranking</span>
                </div>
                <div class="space-y-4 max-h-96 overflow-y-auto" id="behavioralTasks"></div>
            </div>

        </div>

        <!-- TRACKING HISTORY -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                    <i class="fas fa-history text-gray-500"></i>
                    Action History
                </h2>
                <button onclick="clearHistory()" class="text-sm text-gray-500 hover:text-red-500">Clear History</button>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b-2 border-gray-200">
                            <th class="text-left py-3 px-4 font-semibold text-gray-600">Date</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-600">Action</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-600">Category</th>
                            <th class="text-center py-3 px-4 font-semibold text-gray-600">Before</th>
                            <th class="text-center py-3 px-4 font-semibold text-gray-600">After</th>
                            <th class="text-center py-3 px-4 font-semibold text-gray-600">Impact</th>
                        </tr>
                    </thead>
                    <tbody id="historyTable">
                        <!-- Will be populated -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
    // ==========================================
    // SEO IMPROVEMENT PLANNER
    // ==========================================

    const API_BASE = window.location.hostname === 'localhost'
        ? 'https://www.chrisdavidsalon.com'
        : '';

    const STORAGE_KEY = 'seoImprovementTracker';

    // Task definitions - ALL SEO ranking factors
    const improvementTasks = {
        gbp: [
            {
                id: 'gbp-1',
                title: 'Complete ALL Google Business Profile fields',
                description: 'Hours, services, attributes, appointment links - every field matters',
                impact: '+25% visibility in local pack',
                weight: 'HIGH - GBP is 25-30% of ranking',
                link: 'https://business.google.com',
                linkText: 'Edit profile'
            },
            {
                id: 'gbp-2',
                title: 'Add 20+ high-quality photos',
                description: 'Interior, exterior, team, work samples - Google shows photo-rich profiles more',
                impact: '+35% more direction requests',
                weight: 'HIGH',
                link: 'https://business.google.com',
                linkText: 'Add photos'
            },
            {
                id: 'gbp-3',
                title: 'Post weekly updates to GBP',
                description: 'Before/afters, offers, events - shows Google you\'re active',
                impact: '+15-20% profile views',
                weight: 'MEDIUM',
                link: 'https://business.google.com',
                linkText: 'Create post'
            },
            {
                id: 'gbp-4',
                title: 'Add all services with descriptions',
                description: 'Each service = keyword opportunity (balayage, color correction, etc)',
                impact: 'Rank for service-specific searches',
                weight: 'HIGH',
                link: 'https://business.google.com',
                linkText: 'Edit services'
            },
            {
                id: 'gbp-5',
                title: 'Enable and respond to Q&A',
                description: 'Seed your own FAQs, answer customer questions',
                impact: 'More real estate in search results',
                weight: 'MEDIUM',
                link: 'https://business.google.com',
                linkText: 'View Q&A'
            }
        ],
        onpage: [
            {
                id: 'onpage-1',
                title: 'Optimize title tags for each page',
                description: 'Format: "Service | Chris David Salon | Delray Beach"',
                impact: 'Primary ranking factor for target keywords',
                weight: 'HIGH - Title tags are #1 on-page factor',
                technical: true
            },
            {
                id: 'onpage-2',
                title: 'Write unique meta descriptions',
                description: 'Include call-to-action, phone number, location',
                impact: '+15-30% click-through rate',
                weight: 'HIGH',
                technical: true
            },
            {
                id: 'onpage-3',
                title: 'Add LocalBusiness schema markup',
                description: 'Structured data helps Google understand your business',
                impact: 'Rich snippets in search results',
                weight: 'HIGH',
                technical: true
            },
            {
                id: 'onpage-4',
                title: 'Create location-specific landing pages',
                description: 'Pages for "Hair Salon Delray Beach", "Balayage Boca Raton"',
                impact: 'Rank in nearby cities',
                weight: 'MEDIUM'
            },
            {
                id: 'onpage-5',
                title: 'Add internal links between service pages',
                description: 'Link related services to spread page authority',
                impact: 'Better crawling, higher page authority',
                weight: 'MEDIUM',
                technical: true
            },
            {
                id: 'onpage-6',
                title: 'Ensure NAP is consistent everywhere',
                description: 'Name, Address, Phone must match GBP exactly',
                impact: 'Critical for local SEO trust',
                weight: 'HIGH'
            }
        ],
        reviews: [
            {
                id: 'review-1',
                title: 'Ask 3 clients for reviews this week',
                description: 'Text after appointment with direct review link',
                impact: '+3 reviews, signals to Google you\'re active',
                weight: 'HIGH - Reviews are 15-20% of ranking',
                link: 'https://search.google.com/local/writereview?placeid=ChIJxTZ8If_f2IgR2XMxX_zRKSg',
                linkText: 'Get review link'
            },
            {
                id: 'review-2',
                title: 'Respond to EVERY review within 24 hours',
                description: 'Thank positive, address negative professionally',
                impact: 'Response rate affects ranking + builds trust',
                weight: 'HIGH',
                link: 'https://business.google.com',
                linkText: 'View reviews'
            },
            {
                id: 'review-3',
                title: 'Get reviews on other platforms',
                description: 'Yelp, Facebook - diversity of reviews matters',
                impact: 'More citation sources, broader visibility',
                weight: 'MEDIUM',
                link: 'https://biz.yelp.com',
                linkText: 'Claim Yelp'
            },
            {
                id: 'review-4',
                title: 'Create review generation system',
                description: 'Automated text/email after appointments',
                impact: 'Consistent review velocity beats one-time pushes',
                weight: 'HIGH'
            }
        ],
        citations: [
            {
                id: 'cite-1',
                title: 'Claim/update Yelp Business listing',
                description: 'Second most important directory after Google',
                impact: 'High authority backlink + review source',
                weight: 'HIGH - Citations are 15-20% of ranking',
                link: 'https://biz.yelp.com',
                linkText: 'Claim listing'
            },
            {
                id: 'cite-2',
                title: 'List on Yellow Pages / YP.com',
                description: 'Still carries SEO weight for local businesses',
                impact: 'Citation + backlink',
                weight: 'MEDIUM',
                link: 'https://www.yellowpages.com',
                linkText: 'Add listing'
            },
            {
                id: 'cite-3',
                title: 'Join Delray Beach Chamber of Commerce',
                description: 'Local .org backlink = high authority',
                impact: 'Strong local relevance signal',
                weight: 'HIGH',
                link: 'https://delraybeach.com',
                linkText: 'Join chamber'
            },
            {
                id: 'cite-4',
                title: 'Get listed on StyleSeat or Booksy',
                description: 'Industry-specific directories',
                impact: 'Relevant backlinks + booking channel',
                weight: 'MEDIUM'
            },
            {
                id: 'cite-5',
                title: 'Submit to local news/blog for feature',
                description: 'Reach out to Delray Beach Magazine, local bloggers',
                impact: 'High-quality local backlink',
                weight: 'HIGH'
            },
            {
                id: 'cite-6',
                title: 'Ensure NAP consistency across all listings',
                description: 'Audit all directories - name/address/phone must match',
                impact: 'Inconsistent NAP hurts rankings',
                weight: 'HIGH'
            }
        ],
        technical: [
            {
                id: 'tech-1',
                title: 'Improve page speed (currently slow on mobile)',
                description: 'Compress images, enable caching, minify CSS/JS',
                impact: 'Page speed is a direct ranking factor',
                weight: 'HIGH - Technical is 10-15% of ranking',
                technical: true
            },
            {
                id: 'tech-2',
                title: 'Fix Core Web Vitals issues',
                description: 'LCP, FID, CLS - Google\'s page experience metrics',
                impact: 'Better rankings + user experience',
                weight: 'HIGH',
                technical: true
            },
            {
                id: 'tech-3',
                title: 'Ensure mobile-friendliness',
                description: '60%+ of searches are mobile - must be perfect',
                impact: 'Mobile-first indexing means mobile = desktop',
                weight: 'HIGH',
                technical: true
            },
            {
                id: 'tech-4',
                title: 'Add XML sitemap and submit to Search Console',
                description: 'Helps Google find and index all pages',
                impact: 'Faster indexing of new content',
                weight: 'MEDIUM',
                technical: true,
                link: 'https://search.google.com/search-console',
                linkText: 'Search Console'
            },
            {
                id: 'tech-5',
                title: 'Set up Google Search Console',
                description: 'Monitor search performance, fix issues',
                impact: 'See what keywords you rank for',
                weight: 'HIGH',
                technical: true,
                link: 'https://search.google.com/search-console',
                linkText: 'Set up'
            },
            {
                id: 'tech-6',
                title: 'Fix any crawl errors',
                description: 'Broken links, 404s hurt SEO',
                impact: 'Clean site = better crawling',
                weight: 'MEDIUM',
                technical: true
            }
        ],
        behavioral: [
            {
                id: 'behav-1',
                title: 'Improve click-through rate from search',
                description: 'Better titles/descriptions = more clicks = higher rankings',
                impact: 'CTR is a ranking signal',
                weight: 'MEDIUM - Behavioral is 5-10% of ranking'
            },
            {
                id: 'behav-2',
                title: 'Reduce bounce rate (currently 74%)',
                description: 'Add compelling content, faster load, clear CTAs',
                impact: 'Lower bounce = higher engagement signal',
                weight: 'MEDIUM'
            },
            {
                id: 'behav-3',
                title: 'Increase time on site',
                description: 'Add video, galleries, helpful content',
                impact: 'Longer visits = quality signal to Google',
                weight: 'MEDIUM'
            },
            {
                id: 'behav-4',
                title: 'Add clear calls-to-action',
                description: 'Book Now buttons, phone numbers prominent',
                impact: 'More conversions + engagement',
                weight: 'MEDIUM'
            }
        ]
    };

    // Load saved progress
    function loadProgress() {
        try {
            const saved = localStorage.getItem(STORAGE_KEY);
            return saved ? JSON.parse(saved) : { completed: [], history: [], baseline: null };
        } catch (e) {
            return { completed: [], history: [], baseline: null };
        }
    }

    // Save progress
    function saveProgress(data) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    // Render tasks for a category
    function renderTasks(category, containerId) {
        const container = document.getElementById(containerId);
        const progress = loadProgress();
        container.innerHTML = '';

        improvementTasks[category].forEach(task => {
            const isCompleted = progress.completed.includes(task.id);

            const div = document.createElement('div');
            div.className = `p-4 rounded-lg border ${isCompleted ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'}`;
            div.innerHTML = `
                <div class="flex items-start gap-3">
                    <label class="flex items-center mt-1">
                        <input type="checkbox"
                               ${isCompleted ? 'checked' : ''}
                               onchange="toggleTask('${task.id}', '${category}', this.checked)"
                               class="w-5 h-5 rounded border-gray-300 text-green-600 focus:ring-green-500">
                    </label>
                    <div class="flex-1">
                        <h4 class="font-semibold ${isCompleted ? 'text-green-700 line-through' : 'text-gray-800'}">${task.title}</h4>
                        <p class="text-sm text-gray-600 mt-1">${task.description}</p>
                        <div class="flex flex-wrap items-center gap-2 mt-2">
                            ${task.weight?.includes('HIGH') ? '<span class="text-xs px-2 py-1 bg-red-100 text-red-700 rounded font-semibold">HIGH IMPACT</span>' : ''}
                            <span class="text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded">${task.impact}</span>
                            ${task.technical ? '<span class="text-xs px-2 py-1 bg-purple-100 text-purple-700 rounded">Technical</span>' : ''}
                        </div>
                        ${task.link ? `
                            <a href="${task.link}" target="_blank" class="inline-block mt-2 text-sm text-blue-600 hover:text-blue-800">
                                <i class="fas fa-external-link-alt mr-1"></i>${task.linkText}
                            </a>
                        ` : ''}
                    </div>
                </div>
            `;
            container.appendChild(div);
        });
    }

    // Toggle task completion
    async function toggleTask(taskId, category, completed) {
        const progress = loadProgress();

        // Get current metrics for baseline
        let currentMetrics = await fetchCurrentMetrics();

        if (completed) {
            // Mark as completed
            if (!progress.completed.includes(taskId)) {
                progress.completed.push(taskId);
            }

            // Find the task
            const task = improvementTasks[category].find(t => t.id === taskId);

            // Log to history
            progress.history.unshift({
                date: new Date().toISOString(),
                taskId: taskId,
                action: task.title,
                category: category,
                beforeMetrics: currentMetrics,
                status: 'completed'
            });

        } else {
            // Remove from completed
            progress.completed = progress.completed.filter(id => id !== taskId);
        }

        saveProgress(progress);
        renderAllTasks();
        renderHistory();
        updateProgressSummary();
    }

    // Fetch current metrics
    async function fetchCurrentMetrics() {
        try {
            const [compResponse, trafficResponse] = await Promise.all([
                fetch(`${API_BASE}/api/admin-data?type=competitors`),
                fetch(`${API_BASE}/api/ga4-analytics?type=overview`)
            ]);

            const compResult = await compResponse.json();
            const trafficResult = await trafficResponse.json();

            const chrisDavid = compResult.data?.competitors?.find(c =>
                c.isOurSalon || c.name.toLowerCase().includes('chris david')
            );

            return {
                reviews: chrisDavid?.reviews || 0,
                rating: chrisDavid?.rating || 0,
                sessions: trafficResult.data?.sessions || 0,
                users: trafficResult.data?.activeUsers || 0,
                timestamp: new Date().toISOString()
            };
        } catch (e) {
            return null;
        }
    }

    // Render history table
    function renderHistory() {
        const progress = loadProgress();
        const container = document.getElementById('historyTable');
        container.innerHTML = '';

        if (progress.history.length === 0) {
            container.innerHTML = `
                <tr>
                    <td colspan="6" class="py-8 text-center text-gray-500">
                        No actions tracked yet. Complete tasks above to start tracking!
                    </td>
                </tr>
            `;
            return;
        }

        progress.history.slice(0, 20).forEach(item => {
            const date = new Date(item.date);
            const tr = document.createElement('tr');
            tr.className = 'border-b border-gray-100';
            tr.innerHTML = `
                <td class="py-3 px-4 text-sm text-gray-600">${date.toLocaleDateString()}</td>
                <td class="py-3 px-4 text-sm font-medium text-gray-800">${item.action}</td>
                <td class="py-3 px-4">
                    <span class="text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded capitalize">${item.category}</span>
                </td>
                <td class="py-3 px-4 text-center text-sm text-gray-600">
                    ${item.beforeMetrics ? `${item.beforeMetrics.reviews} reviews` : '--'}
                </td>
                <td class="py-3 px-4 text-center text-sm text-gray-600">
                    <span class="text-gray-400">Measuring...</span>
                </td>
                <td class="py-3 px-4 text-center">
                    <span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded">Completed</span>
                </td>
            `;
            container.appendChild(tr);
        });
    }

    // Update progress summary
    async function updateProgressSummary() {
        const progress = loadProgress();
        const totalTasks = Object.values(improvementTasks).flat().length;
        const completedCount = progress.completed.length;
        const pendingCount = totalTasks - completedCount;

        document.getElementById('tasksCompleted').textContent = completedCount;
        document.getElementById('tasksPending').textContent = pendingCount;

        // Get current metrics and compare to baseline
        const currentMetrics = await fetchCurrentMetrics();
        if (currentMetrics && progress.baseline) {
            const reviewsGained = currentMetrics.reviews - progress.baseline.reviews;
            document.getElementById('reviewsGained').textContent = `+${reviewsGained}`;
        }

        // Set baseline if not set
        if (!progress.baseline && currentMetrics) {
            progress.baseline = currentMetrics;
            saveProgress(progress);
        }
    }

    // Render all task categories
    function renderAllTasks() {
        renderTasks('gbp', 'gbpTasks');
        renderTasks('onpage', 'onpageTasks');
        renderTasks('reviews', 'reviewTasks');
        renderTasks('citations', 'citationTasks');
        renderTasks('technical', 'technicalTasks');
        renderTasks('behavioral', 'behavioralTasks');
    }

    // Clear history
    function clearHistory() {
        if (confirm('Clear all history and reset progress?')) {
            localStorage.removeItem(STORAGE_KEY);
            renderAllTasks();
            renderHistory();
            updateProgressSummary();
        }
    }

    // Refresh all data
    async function refreshAll() {
        document.getElementById('lastUpdated').textContent = 'Refreshing...';
        await updateProgressSummary();
        document.getElementById('lastUpdated').textContent =
            `Updated ${new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}`;
    }

    // Initialize
    window.addEventListener('DOMContentLoaded', () => {
        renderAllTasks();
        renderHistory();
        updateProgressSummary();
        document.getElementById('lastUpdated').textContent =
            `Updated ${new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}`;
    });
    </script>
</body>
</html>
