<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>Authority Building - Chris David Salon SEO Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="shared-nav.js"></script>
    <style>
        .pulse-green { animation: pulse-green 2s infinite; }
        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(34, 197, 94, 0); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Shared Navigation -->
    <div id="admin-nav" data-page="authority"></div>

    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- Data Source Banner -->
        <div id="dataSourceBanner" class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
            <div class="flex items-start">
                <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                <div>
                    <span class="font-semibold text-green-800">LIVE Data from OpenPageRank API</span>
                    <p class="text-green-700 text-sm mt-1">
                        PageRank data from 26 competitor domains. Updates monthly. Chris David Salon ranks <strong id="currentRank">#3</strong> in market.
                    </p>
                </div>
            </div>
        </div>

        <!-- Authority Score Header -->
        <div class="bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl shadow-lg p-6 mb-6 text-white">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold mb-2">Authority Building Strategy</h1>
                    <p class="text-purple-100">PageRank from OpenPageRank API - Chris David Salon vs competitors</p>
                </div>
                <div class="text-right">
                    <div class="text-6xl font-bold" id="authorityScore">--</div>
                    <div class="text-purple-100">Authority Score</div>
                    <div class="text-sm text-purple-200 mt-1">PageRank: <span id="pagerankValue">--</span>/10</div>
                </div>
            </div>
        </div>

        <!-- Competitor PageRank Comparison -->
        <div class="bg-white rounded-xl shadow p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">
                    <i class="fas fa-trophy text-yellow-500 mr-2"></i>
                    PageRank Comparison - Top 10 Competitors
                </h2>
                <button onclick="loadAuthorityData()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                    <i class="fas fa-sync-alt mr-2"></i>Refresh
                </button>
            </div>
            <div id="competitorTable" class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="px-4 py-3 text-left">Rank</th>
                            <th class="px-4 py-3 text-left">Domain</th>
                            <th class="px-4 py-3 text-center">PageRank</th>
                            <th class="px-4 py-3 text-center">PR Decimal</th>
                            <th class="px-4 py-3 text-center">Threat Level</th>
                        </tr>
                    </thead>
                    <tbody id="competitorRows">
                        <tr><td colspan="5" class="text-center py-8 text-gray-500">Loading PageRank data...</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                <h4 class="font-bold text-blue-800 mb-2">Analysis Summary</h4>
                <p id="analysisSummary" class="text-sm text-blue-700">
                    Chris David Salon (2.88 PageRank) ranks #3 in the market. Need to overtake Bond Street Salon (3.02) and Studio 10 Boca Raton (3.15).
                </p>
            </div>
        </div>

        <!-- Why Authority Matters -->
        <div class="bg-white rounded-xl shadow p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">
                <i class="fas fa-question-circle text-blue-500 mr-2"></i>
                Why Authority Matters for SEO
            </h2>
            <div class="grid md:grid-cols-3 gap-4">
                <div class="p-4 bg-blue-50 rounded-lg">
                    <div class="text-2xl font-bold text-blue-600 mb-2">~50%</div>
                    <div class="text-sm text-gray-600">of Google's ranking algorithm weighs off-page factors like backlinks and authority</div>
                </div>
                <div class="p-4 bg-green-50 rounded-lg">
                    <div class="text-2xl font-bold text-green-600 mb-2">High DA = High Rank</div>
                    <div class="text-sm text-gray-600">Sites with Domain Authority 50+ typically rank on page 1</div>
                </div>
                <div class="p-4 bg-purple-50 rounded-lg">
                    <div class="text-2xl font-bold text-purple-600 mb-2">3-12 months</div>
                    <div class="text-sm text-gray-600">Time to build meaningful authority with consistent effort</div>
                </div>
            </div>
        </div>

        <!-- WHAT IS AUTHORITY AND WHY IT'S LOW -->
        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl shadow p-6 mb-6 border border-yellow-200">
            <div class="flex items-start gap-3 mb-4">
                <i class="fas fa-lightbulb text-yellow-500 text-2xl mt-1"></i>
                <div>
                    <h2 class="text-xl font-bold text-yellow-800">Why Is Your Authority Low? (And That's Normal)</h2>
                    <p class="text-yellow-700 mt-2">
                        <strong>Authority = How many other websites link to you.</strong> Big brands like Yelp have millions of backlinks.
                        Most local businesses have very few. A score of 29 is actually <em>normal</em> for a local salon - even top competitors barely hit 35-40.
                    </p>
                    <p class="text-yellow-700 mt-2">
                        <strong>The good news:</strong> Even small improvements here have big impact because your competitors are equally weak.
                        Get 3-5 quality backlinks and you could jump from #3 to #1 in authority.
                    </p>
                </div>
            </div>
        </div>

        <!-- ACTIONABLE WEEKLY/MONTHLY TASKS -->
        <div class="bg-white rounded-xl shadow p-6 mb-6">
            <h2 class="text-xl font-bold mb-2 flex items-center">
                <i class="fas fa-calendar-check text-green-500 mr-2"></i>
                Authority Building Schedule
            </h2>
            <p class="text-gray-600 mb-6">Concrete tasks to build authority. Each one creates a backlink or trust signal.</p>

            <!-- This Week -->
            <div class="mb-6 p-4 bg-red-50 rounded-lg border-2 border-red-200">
                <h3 class="font-bold text-red-700 mb-3 text-lg">ðŸ”¥ THIS WEEK (Do Now - Takes 1 Hour)</h3>
                <div class="space-y-3">
                    <div class="flex items-start gap-3 p-3 bg-white rounded-lg">
                        <input type="checkbox" class="mt-1 w-5 h-5 accent-red-500">
                        <div>
                            <div class="font-bold">Claim Delray Beach Chamber of Commerce Listing</div>
                            <div class="text-sm text-gray-600">Go to <a href="https://www.delraybeach.com/directory" target="_blank" class="text-blue-600 underline">delraybeach.com/directory</a> and add your business. Free backlink from .com domain.</div>
                        </div>
                    </div>
                    <div class="flex items-start gap-3 p-3 bg-white rounded-lg">
                        <input type="checkbox" class="mt-1 w-5 h-5 accent-red-500">
                        <div>
                            <div class="font-bold">Update Yelp Profile with Website Link</div>
                            <div class="text-sm text-gray-600">Log into <a href="https://biz.yelp.com" target="_blank" class="text-blue-600 underline">biz.yelp.com</a> and ensure your website URL is listed. High-authority backlink.</div>
                        </div>
                    </div>
                    <div class="flex items-start gap-3 p-3 bg-white rounded-lg">
                        <input type="checkbox" class="mt-1 w-5 h-5 accent-red-500">
                        <div>
                            <div class="font-bold">Add Website to Facebook Business Page</div>
                            <div class="text-sm text-gray-600">Check that chrisdavidsalon.com is linked in your Facebook page's About section.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- This Month -->
            <div class="mb-6 p-4 bg-orange-50 rounded-lg border-2 border-orange-200">
                <h3 class="font-bold text-orange-700 mb-3 text-lg">ðŸ“… THIS MONTH (Pick 2 To Complete)</h3>
                <div class="space-y-3">
                    <div class="flex items-start gap-3 p-3 bg-white rounded-lg">
                        <input type="checkbox" class="mt-1 w-5 h-5 accent-orange-500">
                        <div>
                            <div class="font-bold">Email Davines USA About Salon Feature</div>
                            <div class="text-sm text-gray-600">
                                Send to: <span class="font-mono bg-gray-100 px-1">info@davinesna.com</span><br>
                                Subject: "Certified Davines Salon in Delray Beach - Feature Request"<br>
                                Mention: 6 years as educator, certified status, Atlantic Ave location
                            </div>
                        </div>
                    </div>
                    <div class="flex items-start gap-3 p-3 bg-white rounded-lg">
                        <input type="checkbox" class="mt-1 w-5 h-5 accent-orange-500">
                        <div>
                            <div class="font-bold">Pitch to Palm Beach Post Lifestyle Section</div>
                            <div class="text-sm text-gray-600">
                                Story angle: "Delray Beach colorist trained stylists for 5 major brands - now serves locals"<br>
                                Email: <span class="font-mono bg-gray-100 px-1">features@pbpost.com</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-start gap-3 p-3 bg-white rounded-lg">
                        <input type="checkbox" class="mt-1 w-5 h-5 accent-orange-500">
                        <div>
                            <div class="font-bold">Register on StyleSeat/Booksy/Vagaro</div>
                            <div class="text-sm text-gray-600">Each platform = another backlink + potential clients. Even if you don't use them for booking, the profile link helps.</div>
                        </div>
                    </div>
                    <div class="flex items-start gap-3 p-3 bg-white rounded-lg">
                        <input type="checkbox" class="mt-1 w-5 h-5 accent-orange-500">
                        <div>
                            <div class="font-bold">Ask 3 Happy Clients for Google Reviews</div>
                            <div class="text-sm text-gray-600">Reviews don't directly add authority but boost local ranking and trust signals. Text them your Google review link.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quarterly -->
            <div class="p-4 bg-green-50 rounded-lg border-2 border-green-200">
                <h3 class="font-bold text-green-700 mb-3 text-lg">ðŸŽ¯ QUARTERLY (High-Impact Projects)</h3>
                <div class="space-y-3">
                    <div class="flex items-start gap-3 p-3 bg-white rounded-lg">
                        <input type="checkbox" class="mt-1 w-5 h-5 accent-green-500">
                        <div>
                            <div class="font-bold">Create "Best Salons in Delray Beach" Blog Post</div>
                            <div class="text-sm text-gray-600">
                                Write a genuine roundup of top salons (include yourself). Other salons may link to it. Post on your blog.
                            </div>
                        </div>
                    </div>
                    <div class="flex items-start gap-3 p-3 bg-white rounded-lg">
                        <input type="checkbox" class="mt-1 w-5 h-5 accent-green-500">
                        <div>
                            <div class="font-bold">Partner with Local Wedding Venue</div>
                            <div class="text-sm text-gray-600">
                                Contact Sundy House, Colony Hotel, or Delray Beach Marriott. Offer preferred vendor partnership with website link exchange.
                            </div>
                        </div>
                    </div>
                    <div class="flex items-start gap-3 p-3 bg-white rounded-lg">
                        <input type="checkbox" class="mt-1 w-5 h-5 accent-green-500">
                        <div>
                            <div class="font-bold">Sponsor Local Event</div>
                            <div class="text-sm text-gray-600">
                                Delray Affair, Garlic Fest, local charity run. Event websites list sponsors with links. ~$200-500 gets a backlink from high-traffic local site.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chris's Unique Advantages -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl shadow-lg p-6 text-white">
            <h2 class="text-xl font-bold mb-4">
                <i class="fas fa-star mr-2"></i>
                Chris's Unique Advantages for Authority Building
            </h2>
            <div class="grid md:grid-cols-4 gap-4">
                <div class="bg-white/20 p-4 rounded-lg">
                    <div class="text-2xl mb-2">Davines Certified</div>
                    <div class="text-sm text-blue-100">Use this for potential backlink from Davines.com</div>
                </div>
                <div class="bg-white/20 p-4 rounded-lg">
                    <div class="text-2xl mb-2">Former Educator</div>
                    <div class="text-sm text-blue-100">Trained for 5 major brands - pitch to trade publications</div>
                </div>
                <div class="bg-white/20 p-4 rounded-lg">
                    <div class="text-2xl mb-2">High Rating</div>
                    <div class="text-sm text-blue-100">Excellent reviews - leverage for PR opportunities</div>
                </div>
                <div class="bg-white/20 p-4 rounded-lg">
                    <div class="text-2xl mb-2">20+ Years</div>
                    <div class="text-sm text-blue-100">Expert positioning for industry features</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // API Base URL - use production when running locally (serverless functions need Vercel)
        const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'https://www.chrisdavidsalon.com'
            : '';

        // NOTE: No hardcoded data - all metrics come from OpenPageRank API

        async function loadPageData() {
            // Load version
            try {
                const versionRes = await fetch(`${API_BASE}/data/version.json`);
                const versionData = await versionRes.json();
                document.getElementById('versionBadge').textContent = `v${versionData.version}`;
            } catch (e) {
                document.getElementById('versionBadge').textContent = 'v?.?.?';
            }

            document.getElementById('lastUpdate').textContent = `Updated: ${new Date().toLocaleTimeString()}`;

            // Load authority data
            loadAuthorityData();
        }

        async function loadAuthorityData() {
            try {
                // Get live data from OpenPageRank API
                const response = await fetch(`${API_BASE}/api/authority-score?competitors=true`);
                const result = await response.json();

                if (result.success && result.data) {
                    // Show LIVE data status
                    showLiveDataStatus();

                    // Use live API data
                    const authScore = result.data.authority_score;
                    const pagerank = result.data.pagerank_decimal;
                    const position = result.data.comparison?.chris_david_position;

                    document.getElementById('authorityScore').textContent = authScore ?? '--';
                    document.getElementById('pagerankValue').textContent = pagerank?.toFixed(2) ?? '--';
                    document.getElementById('currentRank').textContent = position ? `#${position}` : '--';

                    // Update table with live results
                    if (result.data.all_results && result.data.all_results.length > 0) {
                        renderCompetitorTable(result.data.all_results);
                    } else {
                        showNoDataState('API returned no competitor data');
                    }
                } else {
                    // API returned but with error
                    showApiUnavailable(result.error || 'API returned unsuccessful response');
                }
            } catch (error) {
                console.error('Authority API error:', error);
                showApiUnavailable(error.message);
            }
        }

        function showLiveDataStatus() {
            // Data source banner would be updated here if needed
            console.log('Authority data loaded from LIVE API');
        }

        function showApiUnavailable(message) {
            // Set all scores to unavailable
            document.getElementById('authorityScore').textContent = '--';
            document.getElementById('pagerankValue').textContent = '--';
            document.getElementById('currentRank').textContent = '--';

            // Show helpful message in the table
            const tbody = document.getElementById('competitorRows');
            tbody.innerHTML = `
                <tr>
                    <td colspan="5" class="px-4 py-8 text-center">
                        <div class="text-yellow-600 mb-2">
                            <i class="fas fa-exclamation-triangle text-2xl"></i>
                        </div>
                        <p class="font-semibold text-yellow-800">OpenPageRank API Unavailable</p>
                        <p class="text-sm text-gray-600 mt-1">${message}</p>
                        <p class="text-xs text-gray-500 mt-2">Check OPENPAGERANK_API_KEY in Vercel environment variables</p>
                    </td>
                </tr>
            `;
        }

        function showNoDataState(message) {
            const tbody = document.getElementById('competitorRows');
            tbody.innerHTML = `
                <tr>
                    <td colspan="5" class="px-4 py-8 text-center">
                        <div class="text-gray-400 mb-2">
                            <i class="fas fa-database text-2xl"></i>
                        </div>
                        <p class="font-semibold text-gray-600">No PageRank Data Available</p>
                        <p class="text-sm text-gray-500 mt-1">${message}</p>
                    </td>
                </tr>
            `;
        }

        function renderCompetitorTable(results) {
            const sorted = results
                .filter(r => r.pagerank_decimal)
                .sort((a, b) => b.pagerank_decimal - a.pagerank_decimal)
                .slice(0, 10);

            if (sorted.length === 0) {
                showNoDataState('All competitors returned null PageRank values');
                return;
            }

            const tbody = document.getElementById('competitorRows');
            tbody.innerHTML = sorted.map((item, index) => {
                const isChrisDavid = item.domain === 'chrisdavidsalon.com';
                const rowClass = isChrisDavid ? 'bg-green-50 font-bold' : '';
                // Determine threat level based on how close to Chris David
                const chrisDavidRank = results.find(r => r.domain === 'chrisdavidsalon.com')?.pagerank_decimal ?? 0;
                let threatBadge;
                if (isChrisDavid) {
                    threatBadge = '<span class="px-2 py-1 text-xs rounded bg-green-100 text-green-700">YOUR SITE</span>';
                } else if (item.pagerank_decimal > chrisDavidRank + 0.2) {
                    threatBadge = '<span class="px-2 py-1 text-xs rounded bg-red-100 text-red-700">HIGH</span>';
                } else if (item.pagerank_decimal > chrisDavidRank - 0.2) {
                    threatBadge = '<span class="px-2 py-1 text-xs rounded bg-yellow-100 text-yellow-700">MEDIUM</span>';
                } else {
                    threatBadge = '<span class="px-2 py-1 text-xs rounded bg-gray-100 text-gray-600">LOW</span>';
                }

                return `
                    <tr class="${rowClass} border-b hover:bg-gray-50">
                        <td class="px-4 py-3">${index + 1}</td>
                        <td class="px-4 py-3">${item.domain}</td>
                        <td class="px-4 py-3 text-center">${item.pagerank}/10</td>
                        <td class="px-4 py-3 text-center">${item.pagerank_decimal.toFixed(2)}</td>
                        <td class="px-4 py-3 text-center">${threatBadge}</td>
                    </tr>
                `;
            }).join('');
        }

        loadPageData();
    </script>
</body>
</html>
