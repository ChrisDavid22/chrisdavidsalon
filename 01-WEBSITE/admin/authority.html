<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>Authority Building - Chris David Salon SEO Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .pulse-green { animation: pulse-green 2s infinite; }
        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(34, 197, 94, 0); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Top Navigation -->
    <nav class="bg-gradient-to-r from-indigo-900 to-purple-900 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-green-400 rounded-full pulse-green mr-2"></div>
                        <span class="font-bold text-xl">Chris David SEO Agent</span>
                    </div>
                    <span id="versionBadge" class="bg-green-500 px-2 py-1 rounded text-xs font-bold">Loading...</span>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="lastUpdate" class="text-sm text-indigo-200"></span>
                    <a href="../index.html" class="bg-yellow-500 hover:bg-yellow-600 px-3 py-1 rounded text-sm font-semibold">View Site</a>
                </div>
            </div>
            <div class="flex space-x-1 pb-2 overflow-x-auto">
                <a href="index.html" class="px-4 py-2 hover:bg-white/10 rounded-t">SEO Command</a>
                <a href="traffic.html" class="px-4 py-2 hover:bg-white/10 rounded-t">Traffic</a>
                <a href="competitors.html" class="px-4 py-2 hover:bg-white/10 rounded-t">Competitors</a>
                <a href="rankings.html" class="px-4 py-2 hover:bg-white/10 rounded-t">Rankings</a>
                <a href="authority.html" class="px-4 py-2 bg-white/20 rounded-t font-semibold">Authority</a>
                <a href="microsites.html" class="px-4 py-2 hover:bg-white/10 rounded-t">Microsites</a>
                <a href="agent-log.html" class="px-4 py-2 hover:bg-white/10 rounded-t">Agent Log</a>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- Data Source Banner -->
        <div id="dataSourceBanner" class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
            <div class="flex items-start">
                <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                <div>
                    <span class="font-semibold text-green-800">LIVE Data from OpenPageRank API</span>
                    <p class="text-green-700 text-sm mt-1">
                        PageRank data from 26 competitor domains. Updates monthly. Chris David Salon ranks <strong id="currentRank">#3</strong> in market.
                    </p>
                </div>
            </div>
        </div>

        <!-- Authority Score Header -->
        <div class="bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl shadow-lg p-6 mb-6 text-white">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold mb-2">Authority Building Strategy</h1>
                    <p class="text-purple-100">PageRank from OpenPageRank API - Chris David Salon vs competitors</p>
                </div>
                <div class="text-right">
                    <div class="text-6xl font-bold" id="authorityScore">--</div>
                    <div class="text-purple-100">Authority Score</div>
                    <div class="text-sm text-purple-200 mt-1">PageRank: <span id="pagerankValue">--</span>/10</div>
                </div>
            </div>
        </div>

        <!-- Competitor PageRank Comparison -->
        <div class="bg-white rounded-xl shadow p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">
                    <i class="fas fa-trophy text-yellow-500 mr-2"></i>
                    PageRank Comparison - Top 10 Competitors
                </h2>
                <button onclick="loadAuthorityData()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                    <i class="fas fa-sync-alt mr-2"></i>Refresh
                </button>
            </div>
            <div id="competitorTable" class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="px-4 py-3 text-left">Rank</th>
                            <th class="px-4 py-3 text-left">Domain</th>
                            <th class="px-4 py-3 text-center">PageRank</th>
                            <th class="px-4 py-3 text-center">PR Decimal</th>
                            <th class="px-4 py-3 text-center">Threat Level</th>
                        </tr>
                    </thead>
                    <tbody id="competitorRows">
                        <tr><td colspan="5" class="text-center py-8 text-gray-500">Loading PageRank data...</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                <h4 class="font-bold text-blue-800 mb-2">Analysis Summary</h4>
                <p id="analysisSummary" class="text-sm text-blue-700">
                    Chris David Salon (2.88 PageRank) ranks #3 in the market. Need to overtake Bond Street Salon (3.02) and Studio 10 Boca Raton (3.15).
                </p>
            </div>
        </div>

        <!-- Why Authority Matters -->
        <div class="bg-white rounded-xl shadow p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">
                <i class="fas fa-question-circle text-blue-500 mr-2"></i>
                Why Authority Matters for SEO
            </h2>
            <div class="grid md:grid-cols-3 gap-4">
                <div class="p-4 bg-blue-50 rounded-lg">
                    <div class="text-2xl font-bold text-blue-600 mb-2">~50%</div>
                    <div class="text-sm text-gray-600">of Google's ranking algorithm weighs off-page factors like backlinks and authority</div>
                </div>
                <div class="p-4 bg-green-50 rounded-lg">
                    <div class="text-2xl font-bold text-green-600 mb-2">High DA = High Rank</div>
                    <div class="text-sm text-gray-600">Sites with Domain Authority 50+ typically rank on page 1</div>
                </div>
                <div class="p-4 bg-purple-50 rounded-lg">
                    <div class="text-2xl font-bold text-purple-600 mb-2">3-12 months</div>
                    <div class="text-sm text-gray-600">Time to build meaningful authority with consistent effort</div>
                </div>
            </div>
        </div>

        <!-- Authority Building Actions -->
        <div class="bg-white rounded-xl shadow p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">
                <i class="fas fa-rocket text-green-500 mr-2"></i>
                Authority Building Action Plan
            </h2>

            <div class="grid md:grid-cols-3 gap-6">
                <!-- High Impact -->
                <div>
                    <h3 class="font-bold text-red-600 mb-3 flex items-center">
                        <span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>
                        High Impact Actions
                    </h3>
                    <div class="space-y-3">
                        <div class="p-3 border-l-4 border-red-500 bg-red-50 rounded-r">
                            <div class="font-medium">Get Featured on Davines Website</div>
                            <div class="text-sm text-gray-600 mt-1">Chris is Davines certified. Contact their marketing about being featured as a certified salon.</div>
                        </div>
                        <div class="p-3 border-l-4 border-red-500 bg-red-50 rounded-r">
                            <div class="font-medium">Local News Feature</div>
                            <div class="text-sm text-gray-600 mt-1">Pitch a story to Palm Beach Post lifestyle section about Chris's 20+ years of expertise.</div>
                        </div>
                    </div>
                </div>

                <!-- Medium Impact -->
                <div>
                    <h3 class="font-bold text-orange-600 mb-3 flex items-center">
                        <span class="w-3 h-3 bg-orange-500 rounded-full mr-2"></span>
                        Medium Impact Actions
                    </h3>
                    <div class="space-y-3">
                        <div class="p-3 border-l-4 border-orange-500 bg-orange-50 rounded-r">
                            <div class="font-medium">Get More Google Reviews</div>
                            <div class="text-sm text-gray-600 mt-1">Reviews signal trust to Google. Ask every satisfied client for a review.</div>
                        </div>
                        <div class="p-3 border-l-4 border-orange-500 bg-orange-50 rounded-r">
                            <div class="font-medium">Guest Post on Beauty Blogs</div>
                            <div class="text-sm text-gray-600 mt-1">Write articles for beauty/lifestyle blogs about hair care tips, color trends.</div>
                        </div>
                    </div>
                </div>

                <!-- Ongoing -->
                <div>
                    <h3 class="font-bold text-green-600 mb-3 flex items-center">
                        <span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                        Ongoing Actions
                    </h3>
                    <div class="space-y-3">
                        <div class="p-3 border-l-4 border-green-500 bg-green-50 rounded-r">
                            <div class="font-medium">Share Transformation Content</div>
                            <div class="text-sm text-gray-600 mt-1">Weekly before/after videos on Instagram. Shareable content builds natural backlinks.</div>
                        </div>
                        <div class="p-3 border-l-4 border-green-500 bg-green-50 rounded-r">
                            <div class="font-medium">Local Directory Listings</div>
                            <div class="text-sm text-gray-600 mt-1">Ensure consistent NAP (Name, Address, Phone) across all directories.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chris's Unique Advantages -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl shadow-lg p-6 text-white">
            <h2 class="text-xl font-bold mb-4">
                <i class="fas fa-star mr-2"></i>
                Chris's Unique Advantages for Authority Building
            </h2>
            <div class="grid md:grid-cols-4 gap-4">
                <div class="bg-white/20 p-4 rounded-lg">
                    <div class="text-2xl mb-2">Davines Certified</div>
                    <div class="text-sm text-blue-100">Use this for potential backlink from Davines.com</div>
                </div>
                <div class="bg-white/20 p-4 rounded-lg">
                    <div class="text-2xl mb-2">Former Educator</div>
                    <div class="text-sm text-blue-100">Trained for 5 major brands - pitch to trade publications</div>
                </div>
                <div class="bg-white/20 p-4 rounded-lg">
                    <div class="text-2xl mb-2">High Rating</div>
                    <div class="text-sm text-blue-100">Excellent reviews - leverage for PR opportunities</div>
                </div>
                <div class="bg-white/20 p-4 rounded-lg">
                    <div class="text-2xl mb-2">20+ Years</div>
                    <div class="text-sm text-blue-100">Expert positioning for industry features</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // NOTE: No hardcoded data - all metrics come from OpenPageRank API

        async function loadPageData() {
            // Load version
            try {
                const versionRes = await fetch('/data/version.json');
                const versionData = await versionRes.json();
                document.getElementById('versionBadge').textContent = `v${versionData.version}`;
            } catch (e) {
                document.getElementById('versionBadge').textContent = 'v?.?.?';
            }

            document.getElementById('lastUpdate').textContent = `Updated: ${new Date().toLocaleTimeString()}`;

            // Load authority data
            loadAuthorityData();
        }

        async function loadAuthorityData() {
            try {
                // Get live data from OpenPageRank API
                const response = await fetch('/api/authority-score?competitors=true');
                const result = await response.json();

                if (result.success && result.data) {
                    // Show LIVE data status
                    showLiveDataStatus();

                    // Use live API data
                    const authScore = result.data.authority_score;
                    const pagerank = result.data.pagerank_decimal;
                    const position = result.data.comparison?.chris_david_position;

                    document.getElementById('authorityScore').textContent = authScore ?? '--';
                    document.getElementById('pagerankValue').textContent = pagerank?.toFixed(2) ?? '--';
                    document.getElementById('currentRank').textContent = position ? `#${position}` : '--';

                    // Update table with live results
                    if (result.data.all_results && result.data.all_results.length > 0) {
                        renderCompetitorTable(result.data.all_results);
                    } else {
                        showNoDataState('API returned no competitor data');
                    }
                } else {
                    // API returned but with error
                    showApiUnavailable(result.error || 'API returned unsuccessful response');
                }
            } catch (error) {
                console.error('Authority API error:', error);
                showApiUnavailable(error.message);
            }
        }

        function showLiveDataStatus() {
            // Data source banner would be updated here if needed
            console.log('Authority data loaded from LIVE API');
        }

        function showApiUnavailable(message) {
            // Set all scores to unavailable
            document.getElementById('authorityScore').textContent = '--';
            document.getElementById('pagerankValue').textContent = '--';
            document.getElementById('currentRank').textContent = '--';

            // Show helpful message in the table
            const tbody = document.getElementById('competitorRows');
            tbody.innerHTML = `
                <tr>
                    <td colspan="5" class="px-4 py-8 text-center">
                        <div class="text-yellow-600 mb-2">
                            <i class="fas fa-exclamation-triangle text-2xl"></i>
                        </div>
                        <p class="font-semibold text-yellow-800">OpenPageRank API Unavailable</p>
                        <p class="text-sm text-gray-600 mt-1">${message}</p>
                        <p class="text-xs text-gray-500 mt-2">Check OPENPAGERANK_API_KEY in Vercel environment variables</p>
                    </td>
                </tr>
            `;
        }

        function showNoDataState(message) {
            const tbody = document.getElementById('competitorRows');
            tbody.innerHTML = `
                <tr>
                    <td colspan="5" class="px-4 py-8 text-center">
                        <div class="text-gray-400 mb-2">
                            <i class="fas fa-database text-2xl"></i>
                        </div>
                        <p class="font-semibold text-gray-600">No PageRank Data Available</p>
                        <p class="text-sm text-gray-500 mt-1">${message}</p>
                    </td>
                </tr>
            `;
        }

        function renderCompetitorTable(results) {
            const sorted = results
                .filter(r => r.pagerank_decimal)
                .sort((a, b) => b.pagerank_decimal - a.pagerank_decimal)
                .slice(0, 10);

            if (sorted.length === 0) {
                showNoDataState('All competitors returned null PageRank values');
                return;
            }

            const tbody = document.getElementById('competitorRows');
            tbody.innerHTML = sorted.map((item, index) => {
                const isChrisDavid = item.domain === 'chrisdavidsalon.com';
                const rowClass = isChrisDavid ? 'bg-green-50 font-bold' : '';
                // Determine threat level based on how close to Chris David
                const chrisDavidRank = results.find(r => r.domain === 'chrisdavidsalon.com')?.pagerank_decimal ?? 0;
                let threatBadge;
                if (isChrisDavid) {
                    threatBadge = '<span class="px-2 py-1 text-xs rounded bg-green-100 text-green-700">YOUR SITE</span>';
                } else if (item.pagerank_decimal > chrisDavidRank + 0.2) {
                    threatBadge = '<span class="px-2 py-1 text-xs rounded bg-red-100 text-red-700">HIGH</span>';
                } else if (item.pagerank_decimal > chrisDavidRank - 0.2) {
                    threatBadge = '<span class="px-2 py-1 text-xs rounded bg-yellow-100 text-yellow-700">MEDIUM</span>';
                } else {
                    threatBadge = '<span class="px-2 py-1 text-xs rounded bg-gray-100 text-gray-600">LOW</span>';
                }

                return `
                    <tr class="${rowClass} border-b hover:bg-gray-50">
                        <td class="px-4 py-3">${index + 1}</td>
                        <td class="px-4 py-3">${item.domain}</td>
                        <td class="px-4 py-3 text-center">${item.pagerank}/10</td>
                        <td class="px-4 py-3 text-center">${item.pagerank_decimal.toFixed(2)}</td>
                        <td class="px-4 py-3 text-center">${threatBadge}</td>
                    </tr>
                `;
            }).join('');
        }

        loadPageData();
    </script>
</body>
</html>
