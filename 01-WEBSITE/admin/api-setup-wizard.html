<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Setup Wizard - Chris David Salon Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="ai-config.js"></script>
</head>
<body class="bg-gray-100">
    <!-- Navigation -->
    <nav class="bg-gradient-to-r from-purple-900 to-indigo-900 text-white p-4 shadow-lg">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold">API Setup Wizard</h1>
                    <p class="text-sm text-purple-200">Configure APIs for Full Admin Functionality</p>
                </div>
                <a href="index.html" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded text-sm font-semibold">
                    ‚Üê Back to Dashboard
                </a>
            </div>
        </div>
    </nav>

    <div class="max-w-4xl mx-auto p-6">
        
        <!-- API Status Overview -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold mb-6">üîå API Configuration Status</h2>
            
            <div id="apiStatusList" class="space-y-4">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Google Gemini Setup -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ü§ñ Google Gemini API Setup</h2>
            
            <div class="mb-4">
                <label class="block text-sm font-semibold mb-2">API Key:</label>
                <input type="password" id="geminiApiKey" 
                       placeholder="Enter your Google Gemini API key" 
                       class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
            </div>
            
            <div class="flex gap-4">
                <button onclick="saveGeminiKey()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    <i class="fas fa-save mr-2"></i>Save Key
                </button>
                <button onclick="testGeminiAPI()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                    <i class="fas fa-vial mr-2"></i>Test Connection
                </button>
                <a href="https://makersuite.google.com/app/apikey" target="_blank" 
                   class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">
                    <i class="fas fa-external-link-alt mr-2"></i>Get API Key
                </a>
            </div>
            
            <div id="geminiTestResult" class="mt-4 hidden">
                <!-- Test results will appear here -->
            </div>
        </div>

        <!-- Google Search Console Setup -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">üìä Google Search Console API</h2>
            
            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-4">
                <p class="text-sm">This requires OAuth setup. For now, use the manual method:</p>
            </div>
            
            <a href="https://search.google.com/search-console" target="_blank" 
               class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700 inline-block">
                <i class="fas fa-external-link-alt mr-2"></i>Open Search Console
            </a>
            
            <div class="mt-4 p-4 bg-gray-50 rounded">
                <h3 class="font-semibold mb-2">Manual Steps:</h3>
                <ol class="list-decimal list-inside space-y-1 text-sm">
                    <li>Go to Performance ‚Üí Search Results</li>
                    <li>Check your keyword positions</li>
                    <li>Export data as CSV</li>
                    <li>Update rankings in admin manually</li>
                </ol>
            </div>
        </div>

        <!-- Google Analytics Setup -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">üìà Google Analytics</h2>
            
            <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-4">
                <p class="text-sm">‚úÖ Already configured! Tracking ID: <code class="bg-white px-2 py-1 rounded">G-XQDLWZM5NV</code></p>
            </div>
            
            <a href="https://analytics.google.com" target="_blank" 
               class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700 inline-block">
                <i class="fas fa-chart-line mr-2"></i>View Analytics Dashboard
            </a>
        </div>

        <!-- PageSpeed API -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">‚ö° Google PageSpeed API</h2>
            
            <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-4">
                <p class="text-sm">‚úÖ Working! No API key needed for basic usage.</p>
            </div>
            
            <button onclick="testPageSpeed()" class="bg-green-600 text-white px-6 py-3 rounded hover:bg-green-700">
                <i class="fas fa-tachometer-alt mr-2"></i>Test PageSpeed Now
            </button>
            
            <div id="pageSpeedResult" class="mt-4 hidden">
                <!-- Results will appear here -->
            </div>
        </div>

        <!-- Quick Test All APIs -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold mb-4">üöÄ Quick Test All APIs</h2>
            <p class="mb-4 text-blue-100">Run a comprehensive test of all configured APIs</p>
            
            <button onclick="testAllAPIs()" class="bg-white text-blue-600 px-8 py-3 rounded-lg hover:bg-blue-50 font-bold">
                <i class="fas fa-play-circle mr-2"></i>Run Full API Test Suite
            </button>
            
            <div id="fullTestResults" class="mt-6 hidden">
                <!-- Results will appear here -->
            </div>
        </div>

    </div>

    <script>
    // Load existing API keys on page load
    window.addEventListener('load', () => {
        window.AIConfig.loadApiKeys();
        checkAPIStatus();
        
        // Load saved Gemini key if exists
        const savedGeminiKey = localStorage.getItem('apiKey_GEMINI_API_KEY') || 
                              localStorage.getItem('apiKey_GOOGLE_API_KEY');
        if (savedGeminiKey) {
            document.getElementById('geminiApiKey').value = savedGeminiKey;
        }
        
        // Note: API keys should be added via the form or environment variables
        // Never hardcode keys in the source code
    });

    // Check status of all APIs
    function checkAPIStatus() {
        const statusList = document.getElementById('apiStatusList');
        
        const apis = [
            {
                name: 'Google Gemini',
                key: localStorage.getItem('apiKey_GEMINI_API_KEY'),
                icon: 'ü§ñ',
                getKeyUrl: 'https://makersuite.google.com/app/apikey'
            },
            {
                name: 'Google PageSpeed',
                key: 'No key needed',
                icon: '‚ö°',
                status: 'working'
            },
            {
                name: 'Google Analytics',
                key: 'G-XQDLWZM5NV',
                icon: 'üìà',
                status: 'working'
            },
            {
                name: 'Google Search Console',
                key: localStorage.getItem('apiKey_SEARCH_CONSOLE'),
                icon: 'üìä',
                getKeyUrl: 'https://console.cloud.google.com'
            },
            {
                name: 'Claude AI',
                key: localStorage.getItem('apiKey_ANTHROPIC_API_KEY'),
                icon: 'üß†',
                getKeyUrl: 'https://console.anthropic.com'
            }
        ];

        statusList.innerHTML = apis.map(api => {
            let status, statusColor, statusIcon;
            
            if (api.status === 'working') {
                status = 'Working';
                statusColor = 'green';
                statusIcon = 'check-circle';
            } else if (api.key) {
                status = 'Configured';
                statusColor = 'blue';
                statusIcon = 'key';
            } else {
                status = 'Not Configured';
                statusColor = 'red';
                statusIcon = 'times-circle';
            }

            return `
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                    <div class="flex items-center">
                        <span class="text-2xl mr-3">${api.icon}</span>
                        <div>
                            <h3 class="font-semibold">${api.name}</h3>
                            <p class="text-sm text-gray-600">
                                ${api.key ? (api.key === 'No key needed' ? 'Public API' : 'Key configured') : 'No key found'}
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="px-3 py-1 bg-${statusColor}-100 text-${statusColor}-800 rounded-full text-sm">
                            <i class="fas fa-${statusIcon} mr-1"></i>${status}
                        </span>
                        ${api.getKeyUrl ? `
                            <a href="${api.getKeyUrl}" target="_blank" 
                               class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-external-link-alt"></i>
                            </a>
                        ` : ''}
                    </div>
                </div>
            `;
        }).join('');
    }

    // Save Gemini API Key
    function saveGeminiKey() {
        const apiKey = document.getElementById('geminiApiKey').value;
        if (!apiKey) {
            alert('Please enter an API key');
            return;
        }
        
        localStorage.setItem('apiKey_GEMINI_API_KEY', apiKey);
        localStorage.setItem('apiKey_GOOGLE_API_KEY', apiKey); // Also save as Google API key
        alert('API key saved successfully!');
        checkAPIStatus();
    }

    // Test Gemini API
    async function testGeminiAPI() {
        const resultDiv = document.getElementById('geminiTestResult');
        resultDiv.classList.remove('hidden');
        resultDiv.innerHTML = '<div class="text-blue-600"><i class="fas fa-spinner fa-spin mr-2"></i>Testing Gemini API...</div>';
        
        const apiKey = localStorage.getItem('apiKey_GEMINI_API_KEY');
        if (!apiKey) {
            resultDiv.innerHTML = '<div class="text-red-600"><i class="fas fa-times-circle mr-2"></i>No API key found. Please save your key first.</div>';
            return;
        }

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: "Say 'API connection successful' if you can read this."
                        }]
                    }]
                })
            });

            if (response.ok) {
                const data = await response.json();
                resultDiv.innerHTML = `
                    <div class="bg-green-50 border-l-4 border-green-500 p-4">
                        <p class="text-green-800 font-semibold">
                            <i class="fas fa-check-circle mr-2"></i>Success! Gemini API is working.
                        </p>
                        <p class="text-sm text-green-700 mt-2">
                            Response: ${data.candidates[0].content.parts[0].text}
                        </p>
                    </div>
                `;
            } else {
                throw new Error(`API returned ${response.status}`);
            }
        } catch (error) {
            resultDiv.innerHTML = `
                <div class="bg-red-50 border-l-4 border-red-500 p-4">
                    <p class="text-red-800 font-semibold">
                        <i class="fas fa-times-circle mr-2"></i>Connection failed
                    </p>
                    <p class="text-sm text-red-700 mt-2">Error: ${error.message}</p>
                    <p class="text-xs text-red-600 mt-2">Make sure your API key is valid and has the Gemini API enabled.</p>
                </div>
            `;
        }
    }

    // Test PageSpeed API
    async function testPageSpeed() {
        const resultDiv = document.getElementById('pageSpeedResult');
        resultDiv.classList.remove('hidden');
        resultDiv.innerHTML = '<div class="text-blue-600"><i class="fas fa-spinner fa-spin mr-2"></i>Running PageSpeed test...</div>';
        
        try {
            const response = await fetch('https://pagespeedonline.googleapis.com/pagespeedonline/v5/runPagespeed?url=https://www.chrisdavidsalon.com&strategy=mobile');
            const data = await response.json();
            
            const score = Math.round(data.lighthouseResult.categories.performance.score * 100);
            const fcp = data.lighthouseResult.audits['first-contentful-paint'].displayValue;
            const lcp = data.lighthouseResult.audits['largest-contentful-paint'].displayValue;
            
            resultDiv.innerHTML = `
                <div class="bg-green-50 border-l-4 border-green-500 p-4">
                    <p class="text-green-800 font-semibold">
                        <i class="fas fa-check-circle mr-2"></i>PageSpeed API Working!
                    </p>
                    <div class="mt-3 grid grid-cols-3 gap-4">
                        <div>
                            <p class="text-sm text-gray-600">Performance Score</p>
                            <p class="text-2xl font-bold text-${score >= 90 ? 'green' : score >= 50 ? 'yellow' : 'red'}-600">
                                ${score}/100
                            </p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">First Paint</p>
                            <p class="text-lg font-semibold">${fcp}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Largest Paint</p>
                            <p class="text-lg font-semibold">${lcp}</p>
                        </div>
                    </div>
                </div>
            `;
        } catch (error) {
            resultDiv.innerHTML = `
                <div class="bg-red-50 border-l-4 border-red-500 p-4">
                    <p class="text-red-800 font-semibold">
                        <i class="fas fa-times-circle mr-2"></i>PageSpeed test failed
                    </p>
                    <p class="text-sm text-red-700 mt-2">Error: ${error.message}</p>
                </div>
            `;
        }
    }

    // Test all APIs
    async function testAllAPIs() {
        const resultsDiv = document.getElementById('fullTestResults');
        resultsDiv.classList.remove('hidden');
        resultsDiv.innerHTML = '<div class="text-white"><i class="fas fa-spinner fa-spin mr-2"></i>Running comprehensive API tests...</div>';
        
        const results = [];
        
        // Test PageSpeed
        try {
            const response = await fetch('https://pagespeedonline.googleapis.com/pagespeedonline/v5/runPagespeed?url=https://www.chrisdavidsalon.com&strategy=mobile');
            if (response.ok) {
                results.push({name: 'PageSpeed API', status: 'Working', icon: '‚úÖ'});
            } else {
                results.push({name: 'PageSpeed API', status: 'Failed', icon: '‚ùå'});
            }
        } catch {
            results.push({name: 'PageSpeed API', status: 'Error', icon: '‚ö†Ô∏è'});
        }
        
        // Test Gemini if key exists
        const geminiKey = localStorage.getItem('apiKey_GEMINI_API_KEY');
        if (geminiKey) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${geminiKey}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{parts: [{text: "Test"}]}]
                    })
                });
                if (response.ok) {
                    results.push({name: 'Google Gemini', status: 'Working', icon: '‚úÖ'});
                } else {
                    results.push({name: 'Google Gemini', status: 'Invalid Key', icon: '‚ùå'});
                }
            } catch {
                results.push({name: 'Google Gemini', status: 'Error', icon: '‚ö†Ô∏è'});
            }
        } else {
            results.push({name: 'Google Gemini', status: 'No Key', icon: 'üîë'});
        }
        
        // Check Google Analytics (just verify tracking code exists)
        if (window.gtag) {
            results.push({name: 'Google Analytics', status: 'Installed', icon: '‚úÖ'});
        } else {
            results.push({name: 'Google Analytics', status: 'Not Found', icon: '‚ùå'});
        }
        
        // Display results
        resultsDiv.innerHTML = `
            <div class="bg-white/10 rounded-lg p-4">
                <h3 class="font-bold mb-3 text-white">Test Results:</h3>
                <div class="space-y-2">
                    ${results.map(r => `
                        <div class="flex justify-between items-center bg-white/20 rounded px-3 py-2">
                            <span class="font-semibold">${r.icon} ${r.name}</span>
                            <span class="text-sm">${r.status}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="mt-4 pt-4 border-t border-white/20">
                    <p class="text-sm text-blue-100">
                        ${results.filter(r => r.icon === '‚úÖ').length} of ${results.length} APIs working
                    </p>
                </div>
            </div>
        `;
    }
    </script>
</body>
</html>