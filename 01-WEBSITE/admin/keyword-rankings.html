<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyword Rankings - Chris David Salon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">
    <!-- Standard Admin Navigation v3.0.0 -->
    <nav class="bg-gradient-to-r from-purple-900 to-indigo-900 text-white p-4 shadow-lg">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h1 class="text-2xl font-bold">Chris David Salon Admin v3.0</h1>
                    <p class="text-sm text-purple-200">Keyword Rankings Tracker</p>
                </div>
                <div class="text-right">
                    <p class="text-xs text-green-400">üü¢ Tracking 13 Keywords</p>
                    <p class="text-xs text-purple-200">Last checked: <span id="lastChecked">Loading...</span></p>
                </div>
            </div>
            
            <!-- Clean Navigation - 9 Pages Only -->
            <div class="flex flex-wrap gap-2 text-sm">
                <a href="index.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">üìä Dashboard</a>
                <span class="text-purple-400">|</span>
                <a href="analytics.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">üìà Analytics</a>
                <a href="performance-tracker.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">üìâ Performance</a>
                <span class="text-purple-400">|</span>
                <a href="seo-dashboard.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">üîç SEO</a>
                <a href="keyword-rankings.html" class="bg-purple-600 px-3 py-1 rounded font-bold">üéØ Keywords</a>
                <a href="competitor-analysis.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">üèÜ Competitors</a>
                <span class="text-purple-400">|</span>
                <a href="microsites.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">üåê Microsites</a>
                <a href="reviews-reputation.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">‚≠ê Reviews</a>
                <a href="market-intelligence.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">üéñÔ∏è Market Intel</a>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto p-6">
        
        <!-- Controls -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">üéØ Track Keywords</h2>
                <div class="flex gap-2">
                    <button onclick="checkRankings()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        <i class="fas fa-sync mr-2"></i>Check Now
                    </button>
                    <button onclick="addKeyword()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                        <i class="fas fa-plus mr-2"></i>Add Keyword
                    </button>
                </div>
            </div>
            
            <!-- Add keyword form -->
            <div id="addKeywordForm" class="hidden bg-gray-50 p-4 rounded mb-4">
                <div class="flex gap-2">
                    <input type="text" id="newKeyword" placeholder="Enter keyword to track" 
                        class="flex-1 px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button onclick="saveKeyword()" class="bg-green-600 text-white px-4 py-2 rounded">Save</button>
                    <button onclick="cancelAdd()" class="bg-gray-400 text-white px-4 py-2 rounded">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Current Rankings -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">Current Rankings</h3>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b">
                            <th class="text-left py-2">Keyword</th>
                            <th class="text-center py-2">Position</th>
                            <th class="text-center py-2">Change</th>
                            <th class="text-center py-2">Search Volume</th>
                            <th class="text-center py-2">Competition</th>
                            <th class="text-center py-2">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="rankingsTable">
                        <!-- Will be populated with JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Historical Chart -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">Historical Rankings (30 Days)</h3>
            <canvas id="historyChart" height="100"></canvas>
        </div>

        <!-- Opportunities -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <!-- Quick Wins -->
            <div class="bg-green-50 rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-green-800 mb-4">üéØ Quick Wins</h3>
                <div class="space-y-3" id="quickWins">
                    <!-- Will be populated with JavaScript -->
                </div>
            </div>

            <!-- At Risk -->
            <div class="bg-red-50 rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-red-800 mb-4">‚ö†Ô∏è At Risk</h3>
                <div class="space-y-3" id="atRisk">
                    <!-- Will be populated with JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
    // Data management
    let persistentData = {};
    let currentRankings = {};
    
    const searchVolumes = {
        'hair salon delray beach': 1900,
        'balayage delray beach': 320,
        'best colorist delray beach': 210,
        'color correction delray beach': 140,
        'keratin treatment delray beach': 280,
        'master colorist atlantic ave': 90,
        'davines salon delray beach': 40,
        'hair salon near seagate': 110,
        'blonde specialist delray': 170,
        'balayage expert pineapple grove': 50,
        'best salon del rey': 480,
        'best del rey salon': 390,
        'best salon palm beach': 720
    };

    async function loadData() {
        try {
            const response = await fetch('../data/persistent-store.json');
            persistentData = await response.json();
            
            // Get latest rankings
            const dates = Object.keys(persistentData.keywordRankings || {}).sort();
            const latestDate = dates[dates.length - 1];
            currentRankings = persistentData.keywordRankings?.[latestDate] || {};
            
            document.getElementById('lastChecked').textContent = new Date(latestDate).toLocaleString();
            
            displayRankings();
            updateHistoryChart();
            findOpportunities();
        } catch (error) {
            console.error('Error loading data:', error);
        }
    }

    function displayRankings() {
        const tbody = document.getElementById('rankingsTable');
        tbody.innerHTML = '';
        
        // Get previous rankings for comparison
        const dates = Object.keys(persistentData.keywordRankings || {}).sort();
        const previousDate = dates[dates.length - 2];
        const previousRankings = persistentData.keywordRankings?.[previousDate] || {};
        
        Object.entries(currentRankings).forEach(([keyword, position]) => {
            const previousPosition = previousRankings[keyword];
            const change = previousPosition ? previousPosition - position : 0;
            const volume = searchVolumes[keyword] || 'Unknown';
            
            const row = document.createElement('tr');
            row.className = 'border-b hover:bg-gray-50';
            row.innerHTML = `
                <td class="py-3 font-medium">${keyword}</td>
                <td class="py-3 text-center">
                    <span class="font-bold ${position <= 3 ? 'text-green-600' : position <= 10 ? 'text-yellow-600' : 'text-red-600'}">
                        #${position}
                    </span>
                </td>
                <td class="py-3 text-center">
                    ${change > 0 ? 
                        `<span class="text-green-600">‚Üë${change}</span>` : 
                        change < 0 ? 
                        `<span class="text-red-600">‚Üì${Math.abs(change)}</span>` : 
                        '<span class="text-gray-400">‚Äî</span>'}
                </td>
                <td class="py-3 text-center">${volume}</td>
                <td class="py-3 text-center">
                    <span class="text-xs px-2 py-1 rounded ${
                        volume > 500 ? 'bg-red-100 text-red-800' : 
                        volume > 200 ? 'bg-yellow-100 text-yellow-800' : 
                        'bg-green-100 text-green-800'
                    }">
                        ${volume > 500 ? 'High' : volume > 200 ? 'Medium' : 'Low'}
                    </span>
                </td>
                <td class="py-3 text-center">
                    <button onclick="optimizeKeyword('${keyword}')" class="text-blue-600 hover:text-blue-800">
                        <i class="fas fa-chart-line"></i>
                    </button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    function updateHistoryChart() {
        const ctx = document.getElementById('historyChart').getContext('2d');
        
        // Get all dates
        const dates = Object.keys(persistentData.keywordRankings || {}).sort();
        
        // Prepare datasets for top 5 keywords
        const topKeywords = Object.keys(currentRankings).slice(0, 5);
        const datasets = topKeywords.map((keyword, index) => {
            const data = dates.map(date => persistentData.keywordRankings[date]?.[keyword] || null);
            const colors = ['rgb(59, 130, 246)', 'rgb(168, 85, 247)', 'rgb(34, 197, 94)', 'rgb(251, 191, 36)', 'rgb(239, 68, 68)'];
            
            return {
                label: keyword,
                data: data,
                borderColor: colors[index],
                backgroundColor: colors[index] + '20',
                tension: 0.4
            };
        });
        
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: dates.map(d => new Date(d).toLocaleDateString()),
                datasets: datasets
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        reverse: true,
                        min: 1,
                        max: 30,
                        ticks: {
                            callback: function(value) {
                                return '#' + value;
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    }

    function findOpportunities() {
        const quickWinsDiv = document.getElementById('quickWins');
        const atRiskDiv = document.getElementById('atRisk');
        
        quickWinsDiv.innerHTML = '';
        atRiskDiv.innerHTML = '';
        
        Object.entries(currentRankings).forEach(([keyword, position]) => {
            if (position >= 4 && position <= 7) {
                // Quick wins - close to top 3
                quickWinsDiv.innerHTML += `
                    <div class="bg-white p-3 rounded border-l-4 border-green-500">
                        <div class="font-semibold">${keyword}</div>
                        <div class="text-sm text-gray-600">Currently #${position} - ${4 - position} spots from top 3</div>
                        <button onclick="optimizeKeyword('${keyword}')" class="text-xs bg-green-600 text-white px-2 py-1 rounded mt-1">
                            Optimize Now
                        </button>
                    </div>
                `;
            } else if (position > 15) {
                // At risk - falling behind
                atRiskDiv.innerHTML += `
                    <div class="bg-white p-3 rounded border-l-4 border-red-500">
                        <div class="font-semibold">${keyword}</div>
                        <div class="text-sm text-gray-600">Dropped to #${position}</div>
                        <button onclick="optimizeKeyword('${keyword}')" class="text-xs bg-red-600 text-white px-2 py-1 rounded mt-1">
                            Fix Now
                        </button>
                    </div>
                `;
            }
        });
        
        if (quickWinsDiv.innerHTML === '') {
            quickWinsDiv.innerHTML = '<p class="text-gray-600">No immediate opportunities</p>';
        }
        if (atRiskDiv.innerHTML === '') {
            atRiskDiv.innerHTML = '<p class="text-gray-600">All keywords performing well</p>';
        }
    }

    function checkRankings() {
        // In production, this would call Google Search Console API
        alert('Checking rankings... In production, this will use Google Search Console API to get real rankings.');
        
        // For demo, simulate checking
        document.getElementById('lastChecked').textContent = new Date().toLocaleString();
    }

    function addKeyword() {
        document.getElementById('addKeywordForm').classList.toggle('hidden');
    }

    function saveKeyword() {
        const keyword = document.getElementById('newKeyword').value;
        if (keyword) {
            // In production, this would save to the database
            alert(`Keyword "${keyword}" will be tracked. This will be saved to the database in production.`);
            cancelAdd();
        }
    }

    function cancelAdd() {
        document.getElementById('addKeywordForm').classList.add('hidden');
        document.getElementById('newKeyword').value = '';
    }

    function optimizeKeyword(keyword) {
        // Navigate to SEO dashboard with keyword focus
        window.location.href = `seo-dashboard.html?keyword=${encodeURIComponent(keyword)}`;
    }

    // Load data on page load
    document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>