<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>Weekly Intelligence | Chris David Salon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="shared-nav.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Shared Navigation -->
    <div id="admin-nav" data-page="weekly-brain"></div>

    <div class="max-w-7xl mx-auto p-6">

        <!-- Hero Section -->
        <div class="bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 rounded-2xl shadow-2xl p-8 mb-8">
            <div class="flex items-start justify-between">
                <div>
                    <h1 class="text-4xl font-bold mb-2 flex items-center gap-3">
                        <i class="fas fa-brain text-yellow-400"></i>
                        Weekly SEO Intelligence
                    </h1>
                    <p class="text-purple-100 text-lg mb-4">
                        Powered by the automated SEO Flywheel. Updated every Sunday at 6 AM EST.
                    </p>
                    <div class="flex gap-4">
                        <button onclick="loadIntelligence()" id="refreshBtn" class="bg-yellow-400 hover:bg-yellow-300 text-purple-900 px-6 py-3 rounded-xl font-bold text-lg shadow-lg transform hover:scale-105 transition-all">
                            <i class="fas fa-sync-alt mr-2"></i>
                            Refresh Intelligence
                        </button>
                        <a href="changes-log.html" class="bg-white/20 hover:bg-white/30 text-white px-6 py-3 rounded-xl font-bold text-lg transition-all flex items-center">
                            <i class="fas fa-clipboard-list mr-2"></i>
                            View Changes Log
                        </a>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-sm text-purple-200 mb-1">Status</div>
                    <div id="statusIndicator" class="text-2xl font-bold text-green-400">
                        <i class="fas fa-circle-check mr-2"></i>Ready
                    </div>
                    <div class="text-sm text-purple-200 mt-2" id="lastUpdate">--</div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="hidden text-center py-16">
            <div class="inline-block">
                <i class="fas fa-brain text-6xl text-purple-500 animate-pulse mb-4"></i>
                <div class="text-2xl font-bold text-purple-400 mb-2">Loading Intelligence...</div>
                <div class="text-gray-400">Gathering data from SEO agents...</div>
            </div>
        </div>

        <!-- Main Content -->
        <div id="resultsSection" class="hidden">

            <!-- Boutique Strategy Banner -->
            <div class="bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-xl p-6 mb-8">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-yellow-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-trophy text-gray-900 text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-yellow-400">Boutique Advantage Strategy</h2>
                        <p class="text-gray-300" id="strategyPhilosophy">Win on expertise, not volume. Own niches, not broad terms.</p>
                    </div>
                </div>
            </div>

            <!-- Today's Focus -->
            <div class="bg-gray-800 rounded-xl p-6 mb-8 border-2 border-purple-500">
                <h2 class="text-xl font-bold text-purple-400 mb-4 flex items-center gap-2">
                    <i class="fas fa-bullseye"></i>
                    Today's Priority
                </h2>
                <div id="todayFocus" class="text-2xl font-semibold text-white">
                    Loading...
                </div>
                <div id="todayDay" class="text-gray-400 mt-2">--</div>
            </div>

            <!-- Key Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-gray-800 rounded-xl p-6 border border-blue-500/30">
                    <div class="text-blue-400 text-sm font-semibold mb-1">GBP SCORE</div>
                    <div class="text-4xl font-bold text-blue-400" id="gbpScore">--</div>
                    <div class="text-gray-500 text-sm">32% of ranking</div>
                </div>
                <div class="bg-gray-800 rounded-xl p-6 border border-green-500/30">
                    <div class="text-green-400 text-sm font-semibold mb-1">QUICK WINS</div>
                    <div class="text-4xl font-bold text-green-400" id="quickWinsCount">--</div>
                    <div class="text-gray-500 text-sm">Available today</div>
                </div>
                <div class="bg-gray-800 rounded-xl p-6 border border-yellow-500/30">
                    <div class="text-yellow-400 text-sm font-semibold mb-1">GBP ACTIONS</div>
                    <div class="text-4xl font-bold text-yellow-400" id="gbpActionsCount">--</div>
                    <div class="text-gray-500 text-sm">Pending this week</div>
                </div>
                <div class="bg-gray-800 rounded-xl p-6 border border-purple-500/30">
                    <div class="text-purple-400 text-sm font-semibold mb-1">RECOMMENDATIONS</div>
                    <div class="text-4xl font-bold text-purple-400" id="recsCount">--</div>
                    <div class="text-gray-500 text-sm">Priority actions</div>
                </div>
            </div>

            <!-- GBP Weekly Schedule -->
            <div class="bg-gray-800 rounded-xl p-6 mb-8 border border-yellow-500/30">
                <h2 class="text-xl font-bold text-yellow-400 mb-4 flex items-center gap-2">
                    <i class="fas fa-calendar-week"></i>
                    GBP Weekly Schedule (32% of Local Ranking!)
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4" id="gbpSchedule">
                    <div class="bg-gray-900 rounded-lg p-4">
                        <div class="font-bold text-white mb-1">Monday</div>
                        <div class="text-gray-400 text-sm">Review responses</div>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-4">
                        <div class="font-bold text-white mb-1">Wednesday</div>
                        <div class="text-gray-400 text-sm">Add 2 photos</div>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-4">
                        <div class="font-bold text-white mb-1">Friday</div>
                        <div class="text-gray-400 text-sm">Create Google Post</div>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-4">
                        <div class="font-bold text-white mb-1">Saturday</div>
                        <div class="text-gray-400 text-sm">Check Q&A</div>
                    </div>
                </div>
            </div>

            <!-- Quick Wins -->
            <div class="bg-gray-800 rounded-xl p-6 mb-8 border border-green-500/30">
                <h2 class="text-xl font-bold text-green-400 mb-4 flex items-center gap-2">
                    <i class="fas fa-bolt"></i>
                    Quick Wins (Do These Today!)
                </h2>
                <div id="quickWins" class="space-y-4">
                    Loading...
                </div>
            </div>

            <!-- Ranking Factor Breakdown -->
            <div class="bg-gray-800 rounded-xl p-6 mb-8">
                <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-chart-pie"></i>
                    Where Chris David Salon Can WIN
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="rankingFactors">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Proactive Recommendations -->
            <div class="bg-gray-800 rounded-xl p-6 mb-8 border border-purple-500/30">
                <h2 class="text-xl font-bold text-purple-400 mb-4 flex items-center gap-2">
                    <i class="fas fa-lightbulb"></i>
                    AI Recommendations
                </h2>
                <div id="recommendations" class="space-y-4">
                    Loading...
                </div>
            </div>

        </div>

        <!-- Empty State -->
        <div id="emptyState" class="text-center py-16">
            <i class="fas fa-robot text-6xl text-gray-600 mb-4"></i>
            <div class="text-xl text-gray-400 mb-2">Click "Refresh Intelligence" to load data</div>
            <div class="text-gray-500">This pulls from the automated SEO Flywheel and GBP Agent</div>
        </div>

    </div>

    <script>
    const API_BASE = 'https://www.chrisdavidsalon.com';

    async function loadIntelligence() {
        const btn = document.getElementById('refreshBtn');
        const loading = document.getElementById('loadingState');
        const results = document.getElementById('resultsSection');
        const empty = document.getElementById('emptyState');
        const status = document.getElementById('statusIndicator');

        // Show loading
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Loading...';
        loading.classList.remove('hidden');
        results.classList.add('hidden');
        empty.classList.add('hidden');
        status.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Working...';
        status.className = 'text-2xl font-bold text-yellow-400';

        try {
            // Fetch data from all agents in parallel
            const [proactiveRes, gbpRes, quickWinsRes, strategyRes] = await Promise.all([
                fetch(`${API_BASE}/api/proactive-seo-agent?action=run-proactive`).then(r => r.json()).catch(() => null),
                fetch(`${API_BASE}/api/gbp-agent?action=recommendations`).then(r => r.json()).catch(() => null),
                fetch(`${API_BASE}/api/proactive-seo-agent?action=quick-wins`).then(r => r.json()).catch(() => null),
                fetch(`${API_BASE}/api/proactive-seo-agent?action=boutique-strategy`).then(r => r.json()).catch(() => null)
            ]);

            // Display results
            displayIntelligence(proactiveRes, gbpRes, quickWinsRes, strategyRes);

            status.innerHTML = '<i class="fas fa-circle-check mr-2"></i>Complete';
            status.className = 'text-2xl font-bold text-green-400';
            document.getElementById('lastUpdate').textContent = `Updated: ${new Date().toLocaleString()}`;

        } catch (error) {
            console.error('Error loading intelligence:', error);
            status.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>Error';
            status.className = 'text-2xl font-bold text-red-400';
            empty.innerHTML = `
                <i class="fas fa-exclamation-triangle text-6xl text-red-500 mb-4"></i>
                <div class="text-xl text-red-400 mb-2">Failed to Load</div>
                <div class="text-gray-500">${error.message}</div>
                <button onclick="loadIntelligence()" class="mt-4 bg-purple-600 hover:bg-purple-500 px-6 py-2 rounded-lg">
                    Try Again
                </button>
            `;
            empty.classList.remove('hidden');
        } finally {
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-sync-alt mr-2"></i>Refresh Intelligence';
            loading.classList.add('hidden');
        }
    }

    function displayIntelligence(proactive, gbp, quickWins, strategy) {
        const results = document.getElementById('resultsSection');
        const empty = document.getElementById('emptyState');

        results.classList.remove('hidden');
        empty.classList.add('hidden');

        // Today's focus
        if (proactive?.boutiqueReminder) {
            document.getElementById('todayFocus').textContent = proactive.boutiqueReminder.todaysFocus || 'Check dashboard';
            document.getElementById('todayDay').textContent = proactive.dayOfWeek || '';
        }

        // Strategy philosophy
        if (strategy?.strategy?.philosophy) {
            document.getElementById('strategyPhilosophy').textContent = strategy.strategy.philosophy;
        }

        // Stats
        document.getElementById('gbpScore').textContent = gbp?.gbpScore ? `${gbp.gbpScore}/100` : '--';
        document.getElementById('quickWinsCount').textContent = quickWins?.quickWins?.length || '--';
        document.getElementById('gbpActionsCount').textContent = gbp?.data?.immediateActions?.length || '--';
        document.getElementById('recsCount').textContent = proactive?.recommendations?.length || '--';

        // Quick Wins
        if (quickWins?.quickWins) {
            const quickWinsHtml = quickWins.quickWins.map(win => `
                <div class="bg-gray-900 rounded-lg p-4 flex items-start gap-4">
                    <div class="w-10 h-10 rounded-full bg-green-500 flex items-center justify-center flex-shrink-0">
                        <span class="text-white font-bold">${win.priority}</span>
                    </div>
                    <div class="flex-1">
                        <div class="font-semibold text-white">${win.action}</div>
                        <div class="text-gray-400 text-sm">${win.reason}</div>
                        <div class="text-green-400 text-sm mt-1">
                            <i class="fas fa-clock mr-1"></i>${win.timeToComplete}
                            <span class="text-gray-500 mx-2">|</span>
                            <span class="text-yellow-400">${win.impact} impact</span>
                        </div>
                    </div>
                </div>
            `).join('');
            document.getElementById('quickWins').innerHTML = quickWinsHtml;
        }

        // Ranking Factors
        if (strategy?.strategy?.rankingFactorBreakdown) {
            const factors = strategy.strategy.rankingFactorBreakdown;
            const factorsHtml = Object.entries(factors).map(([key, data]) => {
                const statusColors = {
                    'WINNABLE': 'text-green-400 bg-green-500/20',
                    'COMPETE ON QUALITY': 'text-yellow-400 bg-yellow-500/20',
                    'ADVANTAGE': 'text-blue-400 bg-blue-500/20'
                };
                const colorClass = statusColors[data.status] || 'text-gray-400 bg-gray-500/20';

                return `
                    <div class="bg-gray-900 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-bold text-white capitalize">${key.replace(/([A-Z])/g, ' $1')}</span>
                            <span class="text-xl font-bold text-purple-400">${data.weight}</span>
                        </div>
                        <div class="flex items-center gap-2 mb-2">
                            <span class="px-2 py-1 rounded text-xs font-bold ${colorClass}">${data.status}</span>
                        </div>
                        <div class="text-gray-400 text-sm">${data.action}</div>
                    </div>
                `;
            }).join('');
            document.getElementById('rankingFactors').innerHTML = factorsHtml;
        }

        // Recommendations
        if (proactive?.recommendations) {
            const recsHtml = proactive.recommendations.map(rec => {
                const priorityColors = {
                    'HIGH': 'bg-red-500',
                    'MEDIUM': 'bg-yellow-500',
                    'LOW': 'bg-gray-500'
                };
                const bgColor = priorityColors[rec.priority] || 'bg-gray-500';

                return `
                    <div class="bg-gray-900 rounded-lg p-4 flex items-start gap-4">
                        <div class="w-3 h-3 rounded-full ${bgColor} mt-2 flex-shrink-0"></div>
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-xs font-bold ${bgColor} text-white px-2 py-0.5 rounded">${rec.priority}</span>
                                <span class="text-xs text-gray-500">${rec.category}</span>
                            </div>
                            <div class="font-semibold text-white">${rec.recommendation}</div>
                            <div class="text-gray-400 text-sm mt-1">${rec.reason}</div>
                        </div>
                    </div>
                `;
            }).join('');
            document.getElementById('recommendations').innerHTML = recsHtml;
        }
    }

    // Auto-load on page load
    document.addEventListener('DOMContentLoaded', loadIntelligence);
    </script>
</body>
</html>
