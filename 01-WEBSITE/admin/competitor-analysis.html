<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competitor Analysis - Chris David Salon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">
    <!-- Standard Admin Navigation v3.0.0 -->
    <nav class="bg-gradient-to-r from-purple-900 to-indigo-900 text-white p-4 shadow-lg">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h1 class="text-2xl font-bold">Chris David Salon Admin v3.0</h1>
                    <p class="text-sm text-purple-200">Real-Time Competitor Analysis</p>
                </div>
                <div class="text-right">
                    <p class="text-xs text-green-400">üü¢ API Connected</p>
                    <p class="text-xs text-purple-200">Google PageSpeed API Active</p>
                </div>
            </div>
            
            <!-- Clean Navigation - 9 Pages Only -->
            <div class="flex flex-wrap gap-2 text-sm">
                <a href="index.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">üìä Dashboard</a>
                <span class="text-purple-400">|</span>
                <a href="analytics.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">üìà Analytics</a>
                <a href="performance-tracker.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">üìâ Performance</a>
                <span class="text-purple-400">|</span>
                <a href="seo-dashboard.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">üîç SEO</a>
                <a href="keyword-rankings.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">üéØ Keywords</a>
                <a href="competitor-analysis.html" class="bg-purple-600 px-3 py-1 rounded font-bold">üèÜ Competitors</a>
                <span class="text-purple-400">|</span>
                <a href="microsites.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">üåê Microsites</a>
                <a href="reviews-reputation.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">‚≠ê Reviews</a>
                <a href="market-intelligence.html" class="bg-purple-800 hover:bg-purple-700 px-3 py-1 rounded">üéñÔ∏è Market Intel</a>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto p-6">
        
        <!-- Live Analysis Controls -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">üîç Live Competitor Analysis</h2>
                <button onclick="runFullAnalysis()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-semibold">
                    <i class="fas fa-sync mr-2"></i>Run Full Analysis
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <button onclick="analyzeCompetitor('https://www.chrisdavidsalon.com', 'You')" 
                    class="bg-green-100 hover:bg-green-200 p-4 rounded-lg text-center transition">
                    <div class="font-bold text-green-800">Chris David Salon</div>
                    <div class="text-sm text-gray-600">Your Site</div>
                </button>
                
                <button onclick="analyzeCompetitor('https://www.salonsora.com', 'Salon Sora')" 
                    class="bg-purple-100 hover:bg-purple-200 p-4 rounded-lg text-center transition">
                    <div class="font-bold text-purple-800">Salon Sora</div>
                    <div class="text-sm text-gray-600">#1 Competitor</div>
                </button>
                
                <button onclick="analyzeCompetitor('https://www.drybar.com/locations/delray-beach', 'Drybar')" 
                    class="bg-blue-100 hover:bg-blue-200 p-4 rounded-lg text-center transition">
                    <div class="font-bold text-blue-800">Drybar Delray</div>
                    <div class="text-sm text-gray-600">#2 Competitor</div>
                </button>
                
                <button onclick="analyzeCompetitor('https://www.thewsalon.com', 'The W Salon')" 
                    class="bg-yellow-100 hover:bg-yellow-200 p-4 rounded-lg text-center transition">
                    <div class="font-bold text-yellow-800">The W Salon</div>
                    <div class="text-sm text-gray-600">#3 Competitor</div>
                </button>
            </div>
        </div>

        <!-- Live Scores -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">üìä Live Performance Scores</h3>
            
            <div id="loadingIndicator" class="hidden text-center py-8">
                <i class="fas fa-spinner fa-spin text-4xl text-blue-600"></i>
                <p class="mt-4 text-gray-600">Fetching real-time data from Google PageSpeed API...</p>
                <p class="text-sm text-gray-500 mt-2">This takes 10-15 seconds per site</p>
            </div>
            
            <div id="scoresGrid" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- Scores will be populated here -->
            </div>
            
            <div class="mt-6">
                <canvas id="comparisonChart" height="80"></canvas>
            </div>
        </div>

        <!-- Detailed Breakdown -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            
            <!-- Strengths & Weaknesses -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold mb-4">üí™ Your Strengths</h3>
                <div id="strengths" class="space-y-2">
                    <!-- Will be populated after analysis -->
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold mb-4">‚ö†Ô∏è Areas to Improve</h3>
                <div id="weaknesses" class="space-y-2">
                    <!-- Will be populated after analysis -->
                </div>
            </div>
        </div>

        <!-- Action Items -->
        <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg shadow-lg p-6">
            <h3 class="text-xl font-bold mb-4">üéØ Action Items to Beat Competitors</h3>
            <div id="actionItems" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Will be populated after analysis -->
            </div>
        </div>
    </div>

    <script>
    // Google PageSpeed API configuration
    const API_KEY = 'AIzaSyDCQAaVgiaUdYMXF32V4BflzsAA2mbVokg';
    const competitors = {};
    
    // Load historical data
    let persistentData = {};
    
    async function loadData() {
        try {
            const response = await fetch('../data/persistent-store.json');
            persistentData = await response.json();
            
            // Display last known scores
            displayLastKnownScores();
        } catch (error) {
            console.error('Error loading data:', error);
        }
    }

    function displayLastKnownScores() {
        const latestDate = Object.keys(persistentData.competitorScores || {}).sort().pop();
        const scores = persistentData.competitorScores?.[latestDate] || {};
        
        const scoresGrid = document.getElementById('scoresGrid');
        scoresGrid.innerHTML = '';
        
        Object.entries(scores).forEach(([domain, data]) => {
            const name = domain.replace('.com', '').replace('chrisdavidsalon', 'Chris David');
            const card = document.createElement('div');
            card.className = 'bg-gray-50 p-4 rounded-lg text-center';
            card.innerHTML = `
                <h4 class="font-bold mb-2">${name}</h4>
                <div class="text-3xl font-bold ${data.overall >= 80 ? 'text-green-600' : data.overall >= 70 ? 'text-yellow-600' : 'text-red-600'}">
                    ${data.overall}
                </div>
                <div class="text-sm text-gray-600">Overall Score</div>
                <div class="text-xs mt-2">
                    <span class="block">Performance: ${data.performance}</span>
                    <span class="block">SEO: ${data.seo}</span>
                    <span class="block">Accessibility: ${data.accessibility}</span>
                </div>
            `;
            scoresGrid.appendChild(card);
        });
        
        updateComparisonChart(scores);
    }

    async function analyzeCompetitor(url, name) {
        document.getElementById('loadingIndicator').classList.remove('hidden');
        
        try {
            // Call Google PageSpeed Insights API
            const apiUrl = `https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=${encodeURIComponent(url)}&key=${API_KEY}&category=performance&category=accessibility&category=seo&category=best-practices`;
            
            const response = await fetch(apiUrl);
            const data = await response.json();
            
            if (data.lighthouseResult) {
                const scores = {
                    performance: Math.round(data.lighthouseResult.categories.performance.score * 100),
                    accessibility: Math.round(data.lighthouseResult.categories.accessibility.score * 100),
                    seo: Math.round(data.lighthouseResult.categories.seo.score * 100),
                    bestPractices: Math.round(data.lighthouseResult.categories['best-practices'].score * 100),
                    overall: 0
                };
                
                scores.overall = Math.round((scores.performance + scores.accessibility + scores.seo + scores.bestPractices) / 4);
                
                competitors[name] = scores;
                
                // Update display
                updateScoreDisplay(name, scores);
                
                // Save to persistent store
                saveScores();
            }
        } catch (error) {
            console.error('Analysis error:', error);
            alert(`Error analyzing ${name}. API may be rate limited. Using cached data.`);
        } finally {
            document.getElementById('loadingIndicator').classList.add('hidden');
        }
    }

    function updateScoreDisplay(name, scores) {
        const scoresGrid = document.getElementById('scoresGrid');
        
        // Find or create card for this competitor
        let card = document.getElementById(`score-${name.replace(/\s/g, '-')}`);
        if (!card) {
            card = document.createElement('div');
            card.id = `score-${name.replace(/\s/g, '-')}`;
            card.className = 'bg-gradient-to-br from-white to-gray-50 p-4 rounded-lg text-center shadow';
            scoresGrid.appendChild(card);
        }
        
        card.innerHTML = `
            <h4 class="font-bold mb-2">${name}</h4>
            <div class="text-4xl font-bold ${scores.overall >= 80 ? 'text-green-600' : scores.overall >= 70 ? 'text-yellow-600' : 'text-red-600'}">
                ${scores.overall}
            </div>
            <div class="text-sm text-gray-600 mb-2">Overall Score</div>
            <div class="space-y-1 text-xs">
                <div class="flex justify-between">
                    <span>Performance:</span>
                    <span class="font-bold">${scores.performance}</span>
                </div>
                <div class="flex justify-between">
                    <span>SEO:</span>
                    <span class="font-bold">${scores.seo}</span>
                </div>
                <div class="flex justify-between">
                    <span>Accessibility:</span>
                    <span class="font-bold">${scores.accessibility}</span>
                </div>
                <div class="flex justify-between">
                    <span>Best Practices:</span>
                    <span class="font-bold">${scores.bestPractices}</span>
                </div>
            </div>
            <div class="mt-2 text-xs text-gray-500">
                Updated: ${new Date().toLocaleTimeString()}
            </div>
        `;
        
        // Update comparison chart
        if (Object.keys(competitors).length > 1) {
            updateComparisonChart(competitors);
        }
        
        // Analyze strengths and weaknesses
        if (name === 'You') {
            analyzeStrengthsWeaknesses();
        }
    }

    function updateComparisonChart(data) {
        const ctx = document.getElementById('comparisonChart').getContext('2d');
        
        const labels = Object.keys(data);
        const datasets = [
            {
                label: 'Performance',
                data: labels.map(key => data[key].performance),
                backgroundColor: 'rgba(59, 130, 246, 0.5)'
            },
            {
                label: 'SEO',
                data: labels.map(key => data[key].seo),
                backgroundColor: 'rgba(34, 197, 94, 0.5)'
            },
            {
                label: 'Accessibility',
                data: labels.map(key => data[key].accessibility),
                backgroundColor: 'rgba(168, 85, 247, 0.5)'
            }
        ];
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels.map(l => l.replace('chrisdavidsalon.com', 'Chris David')),
                datasets: datasets
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    }

    function analyzeStrengthsWeaknesses() {
        const yourScores = competitors['You'];
        if (!yourScores) return;
        
        const strengths = [];
        const weaknesses = [];
        
        // Compare with other competitors
        Object.entries(competitors).forEach(([name, scores]) => {
            if (name !== 'You') {
                if (yourScores.performance > scores.performance) {
                    strengths.push(`Faster than ${name} by ${yourScores.performance - scores.performance} points`);
                } else {
                    weaknesses.push(`${name} is faster by ${scores.performance - yourScores.performance} points`);
                }
                
                if (yourScores.seo > scores.seo) {
                    strengths.push(`Better SEO than ${name} by ${yourScores.seo - scores.seo} points`);
                } else {
                    weaknesses.push(`${name} has better SEO by ${scores.seo - yourScores.seo} points`);
                }
            }
        });
        
        // Display strengths
        const strengthsDiv = document.getElementById('strengths');
        strengthsDiv.innerHTML = strengths.map(s => 
            `<div class="bg-green-50 p-2 rounded text-sm text-green-800">‚úÖ ${s}</div>`
        ).join('');
        
        // Display weaknesses
        const weaknessesDiv = document.getElementById('weaknesses');
        weaknessesDiv.innerHTML = weaknesses.map(w => 
            `<div class="bg-red-50 p-2 rounded text-sm text-red-800">‚ö†Ô∏è ${w}</div>`
        ).join('');
        
        // Generate action items
        generateActionItems();
    }

    function generateActionItems() {
        const actionItemsDiv = document.getElementById('actionItems');
        const yourScores = competitors['You'];
        
        const items = [];
        
        if (yourScores?.performance < 80) {
            items.push({
                priority: 'high',
                title: 'Improve Page Speed',
                action: 'Optimize images, enable compression, minimize JavaScript'
            });
        }
        
        if (yourScores?.seo < 85) {
            items.push({
                priority: 'high',
                title: 'Boost SEO Score',
                action: 'Add meta descriptions, improve heading structure, add schema markup'
            });
        }
        
        if (yourScores?.accessibility < 90) {
            items.push({
                priority: 'medium',
                title: 'Enhance Accessibility',
                action: 'Add alt text to images, improve color contrast, add ARIA labels'
            });
        }
        
        actionItemsDiv.innerHTML = items.map(item => `
            <div class="bg-white p-4 rounded shadow">
                <div class="flex items-center mb-2">
                    <span class="px-2 py-1 text-xs rounded ${
                        item.priority === 'high' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'
                    }">
                        ${item.priority.toUpperCase()}
                    </span>
                    <h4 class="font-bold ml-2">${item.title}</h4>
                </div>
                <p class="text-sm text-gray-600">${item.action}</p>
                <button class="mt-2 text-xs bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">
                    Take Action
                </button>
            </div>
        `).join('');
    }

    function runFullAnalysis() {
        // Analyze all competitors
        analyzeCompetitor('https://www.chrisdavidsalon.com', 'You');
        setTimeout(() => analyzeCompetitor('https://www.salonsora.com', 'Salon Sora'), 2000);
        setTimeout(() => analyzeCompetitor('https://www.drybar.com/locations/delray-beach', 'Drybar'), 4000);
        setTimeout(() => analyzeCompetitor('https://www.thewsalon.com', 'The W Salon'), 6000);
    }

    function saveScores() {
        // In production, this would save to a database
        // For now, we'll update the JSON file
        const today = new Date().toISOString().split('T')[0];
        
        if (!persistentData.competitorScores) {
            persistentData.competitorScores = {};
        }
        
        persistentData.competitorScores[today] = competitors;
        
        // This would be saved to the server in production
        console.log('Scores saved:', persistentData.competitorScores);
    }

    // Load data on page load
    document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>